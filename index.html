<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compassion Quest - Build Empathy Through Choices</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-item.hidden {
            display: none;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .scenario {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .character {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .character-avatar {
            width: 80px;
            height: 80px;
            aspect-ratio: 1 / 1;
            flex: 0 0 auto;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            margin-right: 20px;
            color: white;
            font-weight: bold;
        }

        /* If we ever use images/icons, avoid distortion */
        img {
            max-width: 100%;
            height: auto;
        }

        .character-info h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .character-info p {
            color: #666;
            line-height: 1.6;
        }

        .scenario-text {
            color: #444;
            line-height: 1.8;
            font-size: 1.1em;
            margin-bottom: 25px;
        }

        .choices {
            display: grid;
            gap: 15px;
        }

        .choice-btn {
            background: white;
            border: 2px solid #667eea;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1em;
            color: #333;
        }

        .choice-btn:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .choice-btn:active {
            transform: translateX(2px);
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .feedback.positive {
            background: #d4edda;
            border-left: 5px solid #28a745;
            color: #155724;
        }

        .feedback.negative {
            background: #f8d7da;
            border-left: 5px solid #dc3545;
            color: #721c24;
        }

        .feedback.neutral {
            background: #d1ecf1;
            border-left: 5px solid #17a2b8;
            color: #0c5460;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .game-over {
            text-align: center;
            padding: 40px;
        }

        .game-over h2 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .final-score {
            font-size: 1.5em;
            color: #666;
            margin-bottom: 30px;
        }

        .restart-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.2em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .restart-btn:hover {
            transform: scale(1.05);
        }

        .hidden {
            display: none;
        }

        .compassion-heart {
            display: inline-block;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .ok-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
        }

        .ok-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .ok-btn:active {
            transform: scale(0.98);
        }

        .skip-btn {
            background: transparent;
            border: 2px solid #999;
            color: #666;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            font-weight: normal;
        }

        .skip-btn:hover {
            background: #f5f5f5;
            border-color: #667eea;
            color: #667eea;
        }

        .skip-btn:active {
            transform: scale(0.98);
        }

        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            background: white;
            border: 2px solid #667eea;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            color: #667eea;
            font-weight: bold;
        }

        .lang-btn:hover {
            background: #667eea;
            color: white;
        }

        .lang-btn.active {
            background: #667eea;
            color: white;
        }

        .game-container {
            position: relative;
        }

        .tutorial {
            text-align: center;
            padding: 40px;
            max-width: 700px;
            margin: 0 auto;
        }

        .tutorial h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .tutorial-section {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: left;
            border-left: 5px solid #667eea;
        }

        .tutorial-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .tutorial-section p {
            color: #444;
            line-height: 1.8;
            font-size: 1.05em;
            margin-bottom: 10px;
        }

        .tutorial-section ul {
            color: #444;
            line-height: 1.8;
            margin-left: 20px;
            margin-top: 10px;
        }

        .tutorial-section li {
            margin-bottom: 8px;
        }

        .start-game-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 30px;
            font-size: 1.3em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
            margin-top: 20px;
        }

        .start-game-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .start-game-btn:active {
            transform: scale(0.98);
        }

        .self-compassion-section {
            text-align: center;
            padding: 40px;
            max-width: 700px;
            margin: 0 auto;
        }

        .self-compassion-section h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .self-compassion-content {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: left;
            border-left: 5px solid #667eea;
        }

        .self-compassion-content h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .self-compassion-content p {
            color: #444;
            line-height: 1.8;
            font-size: 1.05em;
            margin-bottom: 10px;
        }

        .self-compassion-content ul {
            color: #444;
            line-height: 1.8;
            margin-left: 20px;
            margin-top: 10px;
        }

        .self-compassion-content li {
            margin-bottom: 8px;
        }

        .breathing-exercise {
            text-align: center;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto;
        }

        .breathing-exercise h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .breathing-description {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: left;
            border-left: 5px solid #667eea;
            color: #444;
            line-height: 1.8;
            font-size: 1.05em;
        }

        .breathing-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 30px auto;
        }

        .breathing-ring {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.2s ease;
            /* Keep ring visible even when circle expands on small screens */
            z-index: 3;
            pointer-events: none;
        }

        .breathing-ring.active {
            opacity: 1;
        }

        .breathing-ring-track {
            stroke: rgba(154, 160, 166, 0.25);
            stroke-width: 4;
            fill: none;
        }

        .breathing-ring-progress {
            stroke: #9aa0a6;
            stroke-width: 4;
            fill: none;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .breathing-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 1s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            z-index: 2;
        }

        .breathing-circle.inhale {
            width: 250px;
            height: 250px;
            animation: pulse-inhale 4s ease-in-out;
        }

        .breathing-circle.hold {
            width: 250px;
            height: 250px;
            animation: pulse-hold 7s ease-in-out;
        }

        .breathing-circle.exhale {
            width: 100px;
            height: 100px;
            animation: pulse-exhale 8s ease-in-out;
        }

        @keyframes pulse-inhale {
            0% {
                width: 100px;
                height: 100px;
                opacity: 0.7;
            }
            100% {
                width: 250px;
                height: 250px;
                opacity: 1;
            }
        }

        @keyframes pulse-hold {
            0%, 100% {
                width: 250px;
                height: 250px;
                opacity: 1;
            }
        }

        @keyframes pulse-exhale {
            0% {
                width: 250px;
                height: 250px;
                opacity: 1;
            }
            100% {
                width: 100px;
                height: 100px;
                opacity: 0.7;
            }
        }

        .breathing-counter {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            font-weight: bold;
            color: white;
            z-index: 10;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .breathing-phase {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .breathing-repeat-counter {
            font-size: 1.2em;
            color: #666;
            margin-top: 20px;
        }

        .breathing-complete {
            background: #d4edda;
            border-left: 5px solid #28a745;
            color: #155724;
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            font-size: 1.1em;
            line-height: 1.8;
        }

        .scenarios-complete {
            text-align: center;
            padding: 40px;
            max-width: 700px;
            margin: 0 auto;
        }

        .scenarios-complete h2 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .scenarios-complete .result-box {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            border-left: 5px solid #667eea;
        }

        .scenarios-complete .result-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            font-size: 1.2em;
        }

        .scenarios-complete .result-stats div {
            color: #667eea;
            font-weight: bold;
        }

        .transition-screen {
            text-align: center;
            padding: 40px;
            max-width: 700px;
            margin: 0 auto;
        }

        .transition-screen h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .transition-screen p {
            font-size: 1.2em;
            color: #444;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .exercise-section {
            text-align: center;
            padding: 40px;
            max-width: 700px;
            margin: 0 auto;
        }

        .exercise-section h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .exercise-description {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: left;
            border-left: 5px solid #667eea;
            color: #444;
            line-height: 1.8;
            font-size: 1.05em;
        }

        .exercise-textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.05em;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 20px;
            transition: border-color 0.3s ease;
        }

        .exercise-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .exercise-textarea::placeholder {
            color: #999;
        }

        .quiz-section {
            text-align: center;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }

        .quiz-section h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .quiz-description {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
            color: #444;
            line-height: 1.8;
        }

        .quiz-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }

        .quiz-questions-column, .quiz-answers-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .quiz-questions-column {
            align-self: center;
        }

        .quiz-question-box {
            background: #f9f9f9;
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 20px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-weight: bold;
            color: #667eea;
            position: relative;
        }

        .quiz-question-box.has-answer {
            border: 3px solid #28a745;
            background: #d4edda;
        }

        .quiz-answer-box {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            cursor: move;
            transition: all 0.3s ease;
            user-select: none;
            color: #444;
        }

        .quiz-answer-box:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .quiz-answer-box.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .quiz-answer-box.used {
            opacity: 0.4;
            cursor: not-allowed;
            border-color: #999;
        }

        .quiz-answer-box.used:hover {
            transform: none;
            box-shadow: none;
        }

        .quiz-answer-box.selected {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2);
        }

        /* On touch devices we allow selecting even used answers */
        @media (pointer: coarse) {
            .quiz-answer-box {
                cursor: pointer;
            }
            .quiz-answer-box.used {
                cursor: pointer;
            }
        }

        .quiz-dropped-answer {
            margin-top: 10px;
            padding: 10px;
            background: #e7f3ff;
            border-radius: 5px;
            color: #004085;
            font-weight: normal;
        }

        .quiz-results {
            background: #d4edda;
            border-left: 5px solid #28a745;
            color: #155724;
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            font-size: 1.1em;
            line-height: 1.8;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
                align-items: flex-start;
            }

            .game-container {
                padding: 18px;
                border-radius: 14px;
            }

            /* Prevent language buttons overlapping the title */
            .language-selector {
                position: static;
                justify-content: center;
                margin-bottom: 10px;
            }

            h1 {
                font-size: 1.8em;
                margin-bottom: 8px;
            }

            .subtitle {
                font-size: 0.95em;
                margin-bottom: 18px;
            }

            .stats {
                display: grid;
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 14px 18px;
                padding: 14px;
                margin-bottom: 18px;
            }

            .stat-item {
                width: 100%;
            }

            #quizStat {
                grid-column: 1 / -1;
            }

            .stat-value {
                font-size: 1.6em;
            }

            .scenario {
                padding: 18px;
                margin-bottom: 18px;
            }

            .scenario-text {
                font-size: 1.05em;
                line-height: 1.7;
            }

            .character {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .character-avatar {
                width: 64px;
                height: 64px;
                font-size: 1.7em;
                margin-right: 0;
            }

            .tutorial, .self-compassion-section, .quiz-section, .game-over {
                padding: 20px;
            }

            .tutorial-section, .exercise-description, .quiz-description {
                padding: 18px;
            }

            /* Keep breathing circle centered on narrow screens */
            .breathing-container {
                width: 100%;
                max-width: 300px;
                aspect-ratio: 1 / 1;
                height: auto;
                margin: 20px auto;
            }

            .quiz-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="language-selector">
            <button class="lang-btn" onclick="setLanguage('en')" id="lang-en">EN</button>
            <button class="lang-btn active" onclick="setLanguage('sl')" id="lang-sl">SI</button>
        </div>
        <h1 id="gameTitle">‚ù§Ô∏è Compassion Quest</h1>
        <p class="subtitle" id="gameSubtitle">Build empathy through meaningful choices</p>

        <div class="stats hidden" id="statsContainer">
            <div class="stat-item">
                <div class="stat-label" id="statCompassion">Compassion Score</div>
                <div class="stat-value" id="compassionScore">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label" id="statLives">Lives Touched</div>
                <div class="stat-value" id="livesTouched">0</div>
            </div>
            <div class="stat-item" id="scenarioStat">
                <div class="stat-label" id="statScenario">Scenario</div>
                <div class="stat-value" id="scenarioNumber">1/8</div>
            </div>
            <div class="stat-item" id="exercisesStat">
                <div class="stat-label" id="statExercises">Exercises</div>
                <div class="stat-value" id="exercisesNumber">0/4</div>
            </div>
            <div class="stat-item" id="quizStat">
                <div class="stat-label" id="statQuiz">Test</div>
                <div class="stat-value" id="quizNumber">0/1</div>
            </div>
        </div>

        <div id="tutorial" class="tutorial">
            <h2 id="tutorialTitle">Welcome to Compassion Quest</h2>
            
            <div class="tutorial-section">
                <h3 id="tutorialWhatTitle">What is Compassion?</h3>
                <p id="tutorialWhatText"></p>
            </div>

            <div class="tutorial-section">
                <h3 id="tutorialWhyTitle">Why is Compassion Important?</h3>
                <p id="tutorialWhyText"></p>
                <ul id="tutorialWhyList"></ul>
            </div>

            <div class="tutorial-section">
                <h3 id="tutorialHowTitle">How to Play</h3>
                <p id="tutorialHowText"></p>
            </div>

            <button class="start-game-btn" onclick="startGame()" id="startGameBtn">Start Your Journey</button>
        </div>

        <div class="progress-bar hidden" id="progressBarContainer">
            <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
        </div>

        <div id="gameContent" class="hidden">
            <div class="scenario" id="scenario">
                <!-- Scenario content will be dynamically inserted -->
            </div>
            <div id="scenariosComplete" class="scenarios-complete hidden">
                <!-- Scenarios complete content will be dynamically inserted -->
            </div>
            <div id="selfCompassionTransition" class="transition-screen hidden">
                <!-- Transition screen content will be dynamically inserted -->
            </div>
            <div id="selfCompassionSection" class="self-compassion-section hidden">
                <!-- Self-compassion content will be dynamically inserted -->
            </div>
            <div id="breathingExercise" class="breathing-exercise hidden">
                <!-- Breathing exercise content will be dynamically inserted -->
            </div>
            <div id="letterExercise" class="exercise-section hidden">
                <!-- Letter exercise content will be dynamically inserted -->
            </div>
            <div id="gratitudeExercise" class="exercise-section hidden">
                <!-- Gratitude exercise content will be dynamically inserted -->
            </div>
            <div id="mantraExercise" class="exercise-section hidden">
                <!-- Mantra exercise content will be dynamically inserted -->
            </div>
            <div id="compassionQuiz" class="quiz-section hidden">
                <!-- Quiz content will be dynamically inserted -->
            </div>
        </div>

        <div id="gameOver" class="game-over hidden">
            <h2 id="gameOverTitle">üéâ Journey Complete!</h2>
            <div class="final-score" id="finalScore"></div>
            <p style="color: #666; margin-bottom: 30px; line-height: 1.8;" id="gameOverMessage">
                You've completed your compassion quest! Every choice you made had an impact. 
                Remember, compassion is not just about grand gestures‚Äîit's about the small, 
                everyday acts of kindness that make the world a better place.
            </p>
            <button class="restart-btn" onclick="restartGame()" id="restartBtn">Play Again</button>
        </div>
    </div>

    <script>
        let compassionScore = 0;
        let livesTouched = 0;
        let currentScenario = 0;
        let gameScenarios = [];
        let selfCompassionExercise = 0; // 0 = not started, 1 = breathing, 2..4 = random self-compassion exercises
        let selectedSelfCompassionExercises = [];
        let currentSelfCompassionIndex = 0; // 0..2 within selectedSelfCompassionExercises
        let quizActive = false;
        let quizProgress = 0; // 0 = not started, 1 = completed
        // Load saved language preference or default to Slovenian
        let currentLanguage = localStorage.getItem('compassionQuestLanguage') || 'sl';
        const SCENARIOS_PER_GAME = 8;

        // Compassion Quiz Data
        const compassionQuizData = {
            en: [
                {
                    question: "What is compassion?",
                    answers: [
                        "The ability to recognize suffering in others and the genuine desire to help alleviate it",
                        "Feeling sorry for someone",
                        "Avoiding difficult situations",
                        "Being polite to others"
                    ],
                    correctIndex: 0
                },
                {
                    question: "What is the difference between compassion and empathy?",
                    answers: [
                        "Compassion involves understanding and taking action, while empathy is just feeling what others feel",
                        "There is no difference",
                        "Empathy is stronger than compassion",
                        "Compassion is only for close friends"
                    ],
                    correctIndex: 0
                },
                {
                    question: "Why is self-compassion important?",
                    answers: [
                        "It helps you recover from setbacks, reduces stress, and improves your ability to care for others",
                        "It makes you selfish",
                        "It's not important",
                        "It only helps with personal problems"
                    ],
                    correctIndex: 0
                },
                {
                    question: "Why is gratitude important for compassion?",
                    answers: [
                        "Gratitude helps recognize positive aspects of life and cultivates a compassionate mindset",
                        "Gratitude has nothing to do with compassion",
                        "Gratitude is only for material things",
                        "Gratitude makes you less compassionate"
                    ],
                    correctIndex: 0
                }
            ],
            sl: [
                {
                    question: "Kaj je soƒçutje?",
                    answers: [
                        "Sposobnost prepoznati trpljenje pri drugih in iskrena ≈æelja pomagati pri laj≈°anju le-tega",
                        "Ob≈æalovanje nekoga",
                        "Izogibanje te≈æavnim situacijam",
                        "Biti vljuden do drugih"
                    ],
                    correctIndex: 0
                },
                {
                    question: "Kak≈°na je razlika med soƒçutjem in empatijo?",
                    answers: [
                        "Soƒçutje vkljuƒçuje razumevanje in ukrepanje, medtem ko je empatija le obƒçutenje, kar drugi obƒçutijo",
                        "Ni razlike",
                        "Empatija je moƒçnej≈°a od soƒçutja",
                        "Soƒçutje je le za bli≈ænje prijatelje"
                    ],
                    correctIndex: 0
                },
                {
                    question: "Zakaj je samosoƒçutje pomembno?",
                    answers: [
                        "Pomaga preborditi neuspehe, zmanj≈°uje stres in izbolj≈°uje sposobnost skrbeti za druge",
                        "Naredi vas sebiƒçne",
                        "Ni pomembno",
                        "Pomaga le pri osebnih te≈æavah"
                    ],
                    correctIndex: 0
                },
                {
                    question: "Zakaj je hvale≈ænost pomembna za soƒçutje?",
                    answers: [
                        "Hvale≈ænost pomaga prepoznati pozitivne vidike ≈æivljenja in razvija soƒçutno razmi≈°ljanje",
                        "Hvale≈ænost nima niƒç skupnega s soƒçutjem",
                        "Hvale≈ænost je le za materialne stvari",
                        "Hvale≈ænost vas naredi pomehku≈æene"
                    ],
                    correctIndex: 0
                }
            ]
        };

        const translations = {
            en: {
                title: "‚ù§Ô∏è Compassion Quest",
                subtitle: "Build empathy through meaningful choices",
                compassionScore: "Compassion Score",
                livesTouched: "Lives Touched",
                scenario: "Scenario",
                exercises: "Exercises",
                quiz: "Quiz",
                ok: "OK",
                gameOverTitle: "üéâ Journey Complete!",
                gameOverMessage: "You've completed your compassion quest! Every choice you made had an impact. Remember, compassion is not just about grand gestures‚Äîit's about the small, everyday acts of kindness that make the world a better place.",
                playAgain: "Play Again",
                points: "Compassion Points",
                tutorialTitle: "Welcome to Compassion Quest",
                tutorialWhatTitle: "What is Compassion?",
                tutorialWhatText: "Compassion is the ability to recognize suffering in others and the genuine desire to help alleviate it. It goes beyond simply feeling sorry for someone‚Äîcompassion involves understanding, empathy, and taking action to make a positive difference in someone's life.",
                tutorialWhyTitle: "Why is Compassion Important?",
                tutorialWhyText: "Compassion is fundamental to building a healthy, supportive society. Here's why it matters:",
                tutorialWhyList: [
                    "Creates stronger communities where people support and care for each other",
                    "Reduces conflict and promotes understanding between different groups",
                    "Improves mental health and well-being for both givers and receivers",
                    "Builds trust and cooperation in workplaces, schools, and neighborhoods",
                    "Fosters resilience and helps people overcome challenges together",
                    "Makes the world a kinder, more inclusive place for everyone"
                ],
                tutorialHowTitle: "How to Play",
                tutorialHowText: "You'll go through 8 different scenarios where someone needs help or understanding. Read each situation carefully and choose the response that shows the most compassion‚Äîyour choices affect your Compassion Score and the number of Lives Touched. After the scenarios, you'll complete 4 self-compassion exercises, and then finish with a short final quiz to reflect on what you learned. Follow the progress bar and stats at the top as you move through each part of the journey.",
                startGame: "Start Your Journey",
                selfCompassionTitle: "Self-Compassion: Caring for Yourself",
                selfCompassionWhat: "Self-compassion is the practice of treating yourself with the same kindness, understanding, and care that you would offer to a good friend. It involves recognizing your own suffering, understanding that imperfection is part of the human experience, and responding to yourself with warmth and support rather than harsh self-criticism.",
                selfCompassionWhy: "Self-compassion is important because:",
                selfCompassionWhyList: [
                    "It helps you recover from setbacks and failures more quickly",
                    "Reduces anxiety, depression, and stress",
                    "Increases motivation and resilience",
                    "Improves your ability to care for others",
                    "Creates a foundation of inner strength and emotional stability",
                    "Allows you to learn from mistakes without self-judgment"
                ],
                breathingExerciseTitle: "Breathing Exercise for Self-Compassion",
                breathingExerciseDescription: "Take a moment to practice self-compassion through a simple breathing exercise. You will do 4 rounds of breathing: inhale for 4 seconds, hold for 7 seconds, and exhale for 8 seconds. Follow the countdown and breathe naturally. This exercise helps calm your mind and connect with your inner compassion.",
                breathingStartBtn: "Start Breathing Exercise",
                breathingSkipBtn: "Skip",
                breathingSkipTitle: "That's Okay",
                breathingSkipMessage: "It's completely okay if breathing exercises don't feel comfortable for you. Everyone has different ways of practicing self-compassion, and what matters most is that you listen to yourself.",
                breathingSkipAlternative: "Alternative ways to practice self-compassion:",
                breathingSkipAlternatives: [
                    "Take a short walk or gentle movement",
                    "Listen to calming music",
                    "Simply sit quietly and rest",
                    "Write down a few things you're grateful for"
                ],
                breathingSkipContinue: "Continue",
                breathingInhale: "Inhale",
                breathingHold: "Hold",
                breathingExhale: "Exhale",
                breathingRepeat: "Round",
                breathingComplete: "Well done! You've completed the breathing exercise. Take a moment to appreciate this act of self-care.",
                breathingContinueBtn: "Continue",
                scenariosCompleteTitle: "üéâ Scenarios Complete!",
                scenariosCompleteMessage: (score, lives) => {
                    if (score < 0 || lives <= 1) {
                        return "Congratulations! You've completed all scenarios.";
                    }
                    return "Congratulations! You've completed all scenarios. Your compassion has touched many lives.";
                },
                transitionToSelfCompassion: "Now, let's turn that compassion inward. It's time to practice self-compassion.",
                selfCompassionPartTitle: "Self-Compassion Practice",
                supportiveTouchTitle: "Supportive Touch",
                supportiveTouchDescription: "Place a hand on your heart (or another comforting place) and take one slow breath. Notice what it feels like to offer yourself support.",
                supportiveTouchActionBtn: "Place hand and breathe",
                selfCompassionBreakTitle: "Self-Compassion Pause",
                selfCompassionBreakStep1: "1) Notice: This is a moment of difficulty.",
                selfCompassionBreakStep2: "2) Common humanity: Struggle is part of being human.",
                selfCompassionBreakStep3: "3) Kindness: May I be kind to myself right now.",
                selfCompassionBreakNextBtn: "Next",
                permissionSlipTitle: "Permission Slip",
                permissionSlipDescription: "Choose one sentence to give yourself permission today:",
                permissionSlipOption1: "It's okay to take my time.",
                permissionSlipOption2: "A small step is enough for today.",
                permissionSlipOption3: "I don't have to be perfect.",
                permissionSlipOption4: "I can ask for help.",
                innerCriticTitle: "Gentle Reframe",
                innerCriticDescription: "Choose the kinder response to this inner-critic thought:",
                innerCriticThought: "‚ÄúI'm not doing enough.‚Äù",
                innerCriticOption1: "I'm doing what I can, step by step.",
                innerCriticOption2: "It's okay to rest‚Äîrest helps me continue.",
                innerCriticOption3: "I can be imperfect and still worthy.",
                microGratitudeSelfTitle: "One Thing I Appreciate About Myself",
                microGratitudeSelfDescription: "Write one small thing you appreciate about yourself today. It can be as simple as showing up.",
                microGratitudeSelfPlaceholder: "Today I appreciate that I...",
                microGratitudeSelfContinueBtn: "Continue",
                letterExerciseTitle: "Write a Letter to Yourself",
                letterExerciseDescription: "Take a moment and write a compassionate letter to yourself. Think about a challenge you're facing or something you've been hard on yourself about. Write to yourself as you would write to a dear person‚Äîwith kindness, understanding, and support.",
                letterPlaceholder: "Write your letter here...",
                letterContinueBtn: "Continue",
                gratitudeExerciseTitle: "Three Things You're Grateful For",
                gratitudeExerciseDescription: "Take a moment to reflect and write down three things you're grateful for. These can be big or small‚Äîanything that brings you joy, comfort, or appreciation. Practicing gratitude is a powerful way to cultivate self-compassion and recognize the positive aspects of your life.",
                gratitudePlaceholder: "Write three things you're grateful for...",
                gratitudeContinueBtn: "Continue",
                mantraExerciseTitle: "Create Your Self-Compassion Mantra",
                mantraExerciseDescription: "Create a personal mantra or phrase that you can use to remind yourself to be kind and compassionate toward yourself. This should be something meaningful to you‚Äîa short phrase that brings you comfort and reminds you of your worth.",
                mantraPlaceholder: "Write your mantra here...",
                mantraContinueBtn: "Continue",
                continueToQuizBtn: "Continue to Quiz",
                compassionQuizTitle: "What Have You Learned About Compassion?",
                compassionQuizDescription: "Match each question with the correct answer by dragging the boxes on the right onto the boxes on the left side.",
                quizDragInstruction: "Each question has one answer",
                quizTapInstruction: "On mobile: tap an answer, then tap a question to place it (tap again to clear).",
                quizSubmitBtn: "Submit Answers",
                quizResultsTitle: "Quiz Results",
                quizResultsMessage: (correct, total) => `You got ${correct} out of ${total} correct!`,
                quizContinueBtn: "Continue to Final Results",
                exerciseComplete: "Congratulations, you've done something compassionate for yourself.",
                exerciseCompleteMental: "That's okay‚Äîthis exercise can be mental too. Take a moment to reflect, then continue.",
                finalScore: {
                    exceptional: (score, lives) => `üåü Exceptional! Your compassion score is ${score}. You've touched ${lives} lives. You truly understand what it means to be compassionate and care for humanity.`,
                    wonderful: (score, lives) => `‚ú® Wonderful! Your compassion score is ${score}. You've touched ${lives} lives. Your kindness makes a real difference.`,
                    good: (score, lives) => `üëç Good effort! Your compassion score is ${score}. You've touched ${lives} lives. Keep practicing empathy and kindness.`,
                    default: (score, lives) => `üí≠ Your compassion score is ${score}. You've touched ${lives} lives. Remember, every act of kindness matters‚Äîeven the small ones.`
                }
            },
            sl: {
                title: "‚ù§Ô∏è Po poti soƒçutja",
                subtitle: "Gradite empatijo skozi pomembne odloƒçitve",
                compassionScore: "Toƒçke soƒçutja",
                livesTouched: "Dotaknjena ≈æivljenja",
                scenario: "Scenarij",
                exercises: "Vadbe",
                quiz: "Test",
                ok: "V redu",
                gameOverTitle: "üéâ Potovanje konƒçano!",
                gameOverMessage: "Zakljuƒçili ste svojo pot soƒçutja! Vsaka va≈°a odloƒçitev je imela vpliv. Ne pozabite, soƒçutje ni le o velikih gestah - gre za majhna, vsakodnevna dejanja prijaznosti, ki naredijo svet bolj≈°i.",
                playAgain: "Igraj ponovno",
                points: "Toƒçke soƒçutja",
                tutorialTitle: "Dobrodo≈°li v igri Po poti soƒçutja",
                tutorialWhatTitle: "Kaj je soƒçutje?",
                tutorialWhatText: "Soƒçutje je sposobnost prepoznati trpljenje pri drugih in iskrena ≈æelja pomagati pri laj≈°anju le-tega. Gre dlje od preprostega ob≈æalovanja ‚Äì soƒçutje vkljuƒçuje razumevanje, empatijo in ukrepanje za pozitivno spremembo v ≈æivljenju drugega.",
                tutorialWhyTitle: "Zakaj je soƒçutje pomembno?",
                tutorialWhyText: "Soƒçutje je temeljno za gradnjo zdrave, podporne dru≈æbe. Pomembno je zaradi naslednjih razlogov:",
                tutorialWhyList: [
                    "Ustvarja moƒçnej≈°o skupnost, kjer se ljudje medsebojno podpirajo in skrbijo drug za drugega",
                    "Zmanj≈°uje konflikte in spodbuja razumevanje med razliƒçnimi ljudmi",
                    "Izbolj≈°uje du≈°evno zdravje in dobro poƒçutje tako za dajalce kot prejemnike soƒçutja",
                    "Gradi zaupanje in sodelovanje na delovnih mestih, v ≈°olah in soseskah",
                    "Spodbuja odpornost in pomaga ljudem skupaj premagovati izzive",
                    "Naredi svet prijaznej≈°i, bolj vkljuƒçujoƒç prostor za vse"
                ],
                tutorialHowTitle: "Kako igrati",
                tutorialHowText: "Sreƒçali boste 8 razliƒçnih scenarijev, kjer nekdo potrebuje pomoƒç ali razumevanje. Preberite vsako situacijo skrbno in izberite odziv, ki izra≈æa najveƒç soƒçutja - va≈°e izbire vplivajo na toƒçke soƒçutja in ≈°tevilo dotaknjenih ≈æivljenj. Po scenarijih boste opravili 4 vaje samosoƒçutja, na koncu pa ≈°e kratek test, kjer preverite, kaj ste se nauƒçili. Spremljajte vrstico napredka in statistiko na vrhu, da vidite, v katerem delu poti ste.",
                startGame: "Zaƒçnite svojo pot",
                selfCompassionTitle: "Samosoƒçutje: skrb zase",
                selfCompassionWhat: "Samosoƒçutje je praksa, kjer se do sebe obna≈°ate z enako prijaznostjo, razumevanjem in skrbjo, kot bi se do dobrega prijatelja. Vkljuƒçuje prepoznavanje lastnega trpljenja in razumevanje, da je nepopolnost del ƒçlove≈°ke izku≈°nje. Samosoƒçutje je odzivanje nase s toplino in podporo, v nasprotju s strogo samokritiƒçnostjo.",
                selfCompassionWhy: "Samosoƒçutje je pomembno, ker:",
                selfCompassionWhyList: [
                    "Pomaga, da si hitreje opomoremo od neuspehov in padcev",
                    "Zmanj≈°uje tesnobo, depresijo in stres",
                    "Poveƒçuje motivacijo in odpornost",
                    "Izbolj≈°uje sposobnost skrbeti za druge",
                    "Ustvarja temelj notranje moƒçi in ƒçustvene stabilnosti",
                    "Omogoƒça uƒçenje iz napak brez nepotrebnih sodb"
                ],
                breathingExerciseTitle: "Dihalna vaja za samosoƒçutje",
                breathingExerciseDescription: "Vzemite si trenutek za vadbo samosoƒçutja preko preproste dihalne vaje. Izvedli boste 4 cikle dihanja: vdih za 4 sekunde, zadr≈æanje diha za 7 sekund in izdih za 8 sekund. Sledite od≈°tevanju in dihajte naravno. Ta vaja pomaga umiriti um in se povezati z va≈°im notranjim soƒçutjem.",
                breathingStartBtn: "Zaƒçni dihalno vajo",
                breathingSkipBtn: "Preskoƒçi",
                breathingSkipTitle: "V redu je",
                breathingSkipMessage: "Popolnoma je v redu, ƒçe se pri dihalnih vajah ne poƒçutite udobno. Vsakdo ima razliƒçne naƒçine vadbe samosoƒçutja, in najpomembneje je, da se poslu≈°ate.",
                breathingSkipAlternative: "Alternativni naƒçini vadbe samosoƒçutja:",
                breathingSkipAlternatives: [
                    "Naredite kratek sprehod ali ne≈æno gibanje",
                    "Poslu≈°ajte pomirjajoƒço glasbo",
                    "Preprosto sedite tiho in poƒçivajte",
                    "Zapi≈°ite si nekaj stvari, za katere ste hvale≈æni"
                ],
                breathingSkipContinue: "Nadaljuj",
                breathingInhale: "Vdih",
                breathingHold: "Zadr≈æanje diha",
                breathingExhale: "Izdih",
                breathingRepeat: "Krog",
                breathingComplete: "Odliƒçno! Dokonƒçali ste dihalno vajo. Vzemite si trenutek, da cenite ta dejanje samooskrbe.",
                breathingContinueBtn: "Nadaljuj",
                scenariosCompleteTitle: "üéâ Scenariji zakljuƒçeni!",
                scenariosCompleteMessage: (score, lives) => {
                    if (score < 0 || lives <= 1) {
                        return "ƒåestitke! Dokonƒçali ste vse scenarije.";
                    }
                    return "ƒåestitke! Dokonƒçali ste vse scenarije. Va≈°e soƒçutje se je dotaknilo ≈°tevilnih ≈æivljenj.";
                },
                transitionToSelfCompassion: "Zdaj pa obrnimo to soƒçutje navznoter. ƒåas je za vadbo samosoƒçutja.",
                selfCompassionPartTitle: "Vadba samosoƒçutja",
                supportiveTouchTitle: "Podporen dotik",
                supportiveTouchDescription: "Polo≈æite roko na srce (ali drug prijeten del telesa) in naredite en poƒçasen vdih. Opazite, kako je, ko si ponudite podporo.",
                supportiveTouchActionBtn: "Polo≈æi roko in vdihni",
                selfCompassionBreakTitle: "Samosoƒçutni premor",
                selfCompassionBreakStep1: "1) Opazim: To je te≈æek trenutek.",
                selfCompassionBreakStep2: "2) Skupna ƒçlove≈°kost: Trpljenje je del ƒçlove≈°ke izku≈°nje.",
                selfCompassionBreakStep3: "3) Prijaznost: Naj bom do sebe zdaj prijazna/prijazen.",
                selfCompassionBreakNextBtn: "Naprej",
                permissionSlipTitle: "Permisijski listek",
                permissionSlipDescription: "Izberi stavek, s katerim si danes da≈° dovoljenje:",
                permissionSlipOption1: "V redu je, ƒçe si vzamem ƒças.",
                permissionSlipOption2: "Dovolj je, da naredim majhen korak.",
                permissionSlipOption3: "Ni mi treba biti popolna/popoln.",
                permissionSlipOption4: "Lahko prosim za pomoƒç.",
                innerCriticTitle: "Ne≈æen preobrat",
                innerCriticDescription: "Izberi bolj soƒçuten odziv na misel notranjega kritika:",
                innerCriticThought: "¬ªNe delam dovolj.¬´",
                innerCriticOption1: "Delam, kolikor zmorem ‚Äî korak za korakom.",
                innerCriticOption2: "V redu je, ƒçe poƒçivam ‚Äî poƒçitek mi pomaga nadaljevati.",
                innerCriticOption3: "Lahko sem nepopolna/nepopoln in ≈°e vedno vredna/vreden.",
                microGratitudeSelfTitle: "Ena stvar, ki jo cenim pri sebi",
                microGratitudeSelfDescription: "Zapi≈°i eno majhno stvar, ki jo danes ceni≈° pri sebi. Lahko je ƒçisto preprosta.",
                microGratitudeSelfPlaceholder: "Danes cenim pri sebi, da ...",
                microGratitudeSelfContinueBtn: "Nadaljuj",
                letterExerciseTitle: "Napi≈°ite pismo samemu sebi",
                letterExerciseDescription: "Vzemite si trenutek in napi≈°ite soƒçutno pismo samemu sebi. Pomislite na izziv, s katerim se sooƒçate, ali na nekaj, zaradi ƒçesar ste bili strogi do sebe. Pi≈°ite sebi, kot bi pisali dragi osebi - s prijaznostjo, razumevanjem in podporo.",
                letterPlaceholder: "Napi≈°ite svoje pismo tukaj...",
                letterContinueBtn: "Nadaljuj",
                gratitudeExerciseTitle: "Tri stvari, za katere ste hvale≈æni",
                gratitudeExerciseDescription: "Vzemite si trenutek za razmislek in zapi≈°ite tri stvari, za katere ste hvale≈æni. Lahko so velike ali majhne - vse, kar vam prina≈°a veselje, tola≈æbo ali hvale≈ænost. Vadba hvale≈ænosti je moƒçan naƒçin za razvijanje samosoƒçutja in prepoznavanje pozitivnih vidikov va≈°ega ≈æivljenja.",
                gratitudePlaceholder: "Napi≈°ite tri stvari, za katere ste hvale≈æni...",
                gratitudeContinueBtn: "Nadaljuj",
                mantraExerciseTitle: "Ustvarite svojo samo-soƒçutno mantro",
                mantraExerciseDescription: "Ustvarite osebno mantro ali frazo, ki jo lahko uporabite, da se spomnite na prijaznost in soƒçutnost do sebe. To bi moralo biti nekaj pomenljivega za vas - kratka fraza, ki vam prina≈°a tola≈æbo in vas spominja na va≈°o vrednost.",
                mantraPlaceholder: "Napi≈°ite svojo mantro tukaj...",
                mantraContinueBtn: "Nadaljuj",
                continueToQuizBtn: "Nadaljuj na test",
                compassionQuizTitle: "Kaj ste se nauƒçili o soƒçutju?",
                compassionQuizDescription: "Pove≈æite vsako vpra≈°anje s pravilnim odgovorom tako, da povleƒçete ≈°katle z desne na ≈°katle, ki se nahajajo na levi strani.",
                quizDragInstruction: "Vsako vpra≈°anje ima en odgovor",
                quizTapInstruction: "Na mobilnem: tapnite odgovor, nato tapnite vpra≈°anje, da ga pove≈æete (ponovni tap izbri≈°e).",
                quizSubmitBtn: "Oddaj odgovore",
                quizResultsTitle: "Rezultati testa",
                quizResultsMessage: (correct, total) => `Pravilno ste odgovorili na ${correct} od ${total} vpra≈°anj!`,
                quizContinueBtn: "Nadaljuj na konƒçne rezultate",
                exerciseComplete: "ƒåestitke, naredili ste nekaj soƒçutnega do sebe.",
                exerciseCompleteMental: "V redu je ‚Äî ta vaja je lahko tudi mentalna. Vzemite si trenutek za razmislek, nato nadaljujte.",
                finalScore: {
                    exceptional: (score, lives) => `üåü Izjemno! Va≈°a toƒçka soƒçutja je ${score}. Dotaknili ste se ${lives} ≈æivljenj. Resniƒçno razumete, kaj pomeni biti soƒçuten in skrbeti za ƒçlove≈°tvo.`,
                    wonderful: (score, lives) => `‚ú® ƒåudovito! Va≈°a toƒçka soƒçutja je ${score}. Dotaknili ste se ${lives} ≈æivljenj. Va≈°a prijaznost naredi resniƒçno razliko.`,
                    good: (score, lives) => `üëç Dobro delo! Va≈°a toƒçka soƒçutja je ${score}. Dotaknili ste se ${lives} ≈æivljenj. Nadaljujte z vadbo empatije in prijaznosti.`,
                    default: (score, lives) => `üí≠ Va≈°a toƒçka soƒçutja je ${score}. Dotaknili ste se ${lives} ≈æivljenj. Ne pozabite, vsako dejanje prijaznosti ≈°teje‚Äîtudi majhna.`
                }
            }
        };

        function getScenariosForLanguage(lang) {
            const allScenariosData = {
                en: [
                    {
                        character: "üë¥",
                        name: "Elderly Neighbor",
                        situation: "You see your elderly neighbor struggling to carry groceries up the stairs. You're already late for a meeting.",
                        choices: [
                            {
                                text: "Stop and help carry the groceries, even if it makes you late",
                                compassion: 15,
                                feedback: "Your neighbor is grateful and you feel good about helping. Sometimes being late is worth it when someone needs you.",
                                type: "positive"
                            },
                            {
                                text: "Quickly help and explain you're in a hurry",
                                compassion: 8,
                                feedback: "You helped, but rushing made your neighbor feel like a burden. A few extra minutes would have meant a lot.",
                                type: "neutral"
                            },
                            {
                                text: "Pretend you didn't see and continue on your way",
                                compassion: -5,
                                feedback: "You made it on time, but you can't shake the feeling that you missed an opportunity to show kindness.",
                                type: "negative"
                            }
                        ]
                    },
            {
                character: "üòî",
                name: "Classmate",
                situation: "A classmate who usually sits alone looks upset. You notice they've been quiet all week.",
                choices: [
                    {
                        text: "Sit with them and ask if they're okay, genuinely listening",
                        compassion: 20,
                        feedback: "They open up about feeling isolated. Your kindness makes them feel seen and valued. You've made a real connection.",
                        type: "positive"
                    },
                    {
                        text: "Send a quick text message asking if they're okay",
                        compassion: 5,
                        feedback: "It's a nice gesture, but sometimes people need face-to-face connection. They appreciate it but seem to need more.",
                        type: "neutral"
                    },
                    {
                        text: "Assume they want to be alone and don't bother them",
                        compassion: -3,
                        feedback: "Sometimes people who seem to want space actually need someone to reach out. You missed a chance to help.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üêï",
                name: "Lost Dog",
                situation: "You find a lost dog wandering the street. It looks scared and has a collar but no visible owner nearby.",
                choices: [
                    {
                        text: "Stay with the dog, check the tag, and help find the owner",
                        compassion: 18,
                        feedback: "You reunite the dog with its worried owner. The relief and gratitude in their eyes is priceless. You made a real difference today.",
                        type: "positive"
                    },
                    {
                        text: "Call animal control and leave",
                        compassion: 8,
                        feedback: "You did the responsible thing, but the dog seems scared. The owner might have been nearby and found them faster with your help.",
                        type: "neutral"
                    },
                    {
                        text: "Ignore it and assume someone else will help",
                        compassion: -5,
                        feedback: "You walk away, but you can't help wondering what happened to that scared dog. Sometimes compassion means taking action.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üë®‚Äçüíº",
                name: "Struggling Colleague",
                situation: "A colleague at work seems overwhelmed with their workload. You have your own tasks to complete.",
                choices: [
                    {
                        text: "Offer to help with some of their tasks, even if it means working a bit longer",
                        compassion: 16,
                        feedback: "Your colleague is incredibly grateful. Your teamwork strengthens your relationship and creates a more supportive work environment.",
                        type: "positive"
                    },
                    {
                        text: "Give them advice on time management",
                        compassion: 6,
                        feedback: "Your advice is well-intentioned, but sometimes people need practical help, not just suggestions. They appreciate the thought though.",
                        type: "neutral"
                    },
                    {
                        text: "Focus on your own work and let them handle it",
                        compassion: -2,
                        feedback: "You completed your tasks, but you notice the stress is affecting the whole team. Sometimes helping others helps everyone.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üë∂",
                name: "Young Parent",
                situation: "You're in a store and see a young parent with a crying baby, looking stressed while trying to shop. Other customers are giving them dirty looks.",
                choices: [
                    {
                        text: "Offer to help hold the baby or carry their basket, showing understanding",
                        compassion: 20,
                        feedback: "The parent is moved to tears by your kindness. Your compassion in that moment of stress meant everything to them.",
                        type: "positive"
                    },
                    {
                        text: "Give them an understanding smile and move on",
                        compassion: 7,
                        feedback: "Your kindness is noticed and appreciated, though practical help might have been more meaningful.",
                        type: "neutral"
                    },
                    {
                        text: "Avoid them and shop elsewhere to escape the noise",
                        compassion: -4,
                        feedback: "You avoided the situation, but that parent felt the judgment from others. A small act of kindness could have changed their day.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üéì",
                name: "New Student",
                situation: "A new student just transferred to your school. They look lost and nervous, standing alone during lunch.",
                choices: [
                    {
                        text: "Invite them to sit with you and your friends, making them feel welcome",
                        compassion: 22,
                        feedback: "You've made their transition so much easier. They'll always remember your kindness. You've gained a new friend!",
                        type: "positive"
                    },
                    {
                        text: "Wave hello but don't invite them over",
                        compassion: 4,
                        feedback: "A friendly gesture, but they're still alone. Sometimes people need a clear invitation to feel welcome.",
                        type: "neutral"
                    },
                    {
                        text: "Let someone else help them, you're busy with your friends",
                        compassion: -3,
                        feedback: "You stayed in your comfort zone, but that new student spent lunch alone. A small gesture could have made a huge difference.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üåßÔ∏è",
                name: "Homeless Person",
                situation: "You pass by someone who appears to be homeless, sitting in the rain. They're not asking for anything, just trying to stay dry.",
                choices: [
                    {
                        text: "Offer to buy them a warm meal and find them shelter information",
                        compassion: 25,
                        feedback: "Your genuine care and practical help restores their hope. You treated them with dignity and respect. This is true compassion.",
                        type: "positive"
                    },
                    {
                        text: "Give them some spare change",
                        compassion: 10,
                        feedback: "Your generosity helps, but they might need more than money. Still, every act of kindness matters.",
                        type: "neutral"
                    },
                    {
                        text: "Walk by quickly, unsure what to do",
                        compassion: -2,
                        feedback: "You felt uncomfortable, which is understandable. But sometimes the most compassionate thing is to acknowledge someone's humanity.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üíî",
                name: "Friend Going Through Hard Times",
                situation: "A close friend has been going through a difficult breakup and hasn't been themselves lately. They've been canceling plans.",
                choices: [
                    {
                        text: "Show up at their place with their favorite food and just be there to listen",
                        compassion: 24,
                        feedback: "Your friend breaks down in tears of gratitude. Sometimes people need someone to show up without being asked. You've been a true friend.",
                        type: "positive"
                    },
                    {
                        text: "Text them regularly to check in",
                        compassion: 12,
                        feedback: "Your consistent care means a lot, though sometimes people in pain need physical presence and connection.",
                        type: "neutral"
                    },
                    {
                        text: "Give them space and wait for them to reach out",
                        compassion: 2,
                        feedback: "Respecting boundaries is important, but sometimes people who are hurting need someone to reach out first.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üöå",
                name: "Bus Passenger",
                situation: "You're on a crowded bus and notice an elderly person standing while younger people are sitting. No one seems to notice or care.",
                choices: [
                    {
                        text: "Immediately offer your seat and help them get comfortable",
                        compassion: 16,
                        feedback: "The elderly person is deeply grateful. Your simple act of respect and kindness brightens their day and sets a positive example for others.",
                        type: "positive"
                    },
                    {
                        text: "Offer your seat but seem a bit reluctant",
                        compassion: 8,
                        feedback: "You did the right thing, but your hesitation was noticeable. Genuine kindness comes from the heart, not obligation.",
                        type: "neutral"
                    },
                    {
                        text: "Wait for someone else to offer their seat",
                        compassion: -3,
                        feedback: "You waited, but no one else stepped up. Sometimes being the first to act is what makes the difference.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üåç",
                name: "International Student",
                situation: "A student from another country seems to be struggling with the language and looks confused during a group project. Others are getting frustrated with them.",
                choices: [
                    {
                        text: "Patiently help them understand, using simple language and visual aids",
                        compassion: 19,
                        feedback: "Your patience and understanding help them succeed. They're grateful for your kindness and you've made a new friend from another culture.",
                        type: "positive"
                    },
                    {
                        text: "Translate for them but seem rushed",
                        compassion: 9,
                        feedback: "You helped, but your impatience made them feel like a burden. A little more patience would have meant a lot.",
                        type: "neutral"
                    },
                    {
                        text: "Let others handle it and focus on your part",
                        compassion: -2,
                        feedback: "You completed your work, but the student felt excluded. Inclusion takes effort, but it's worth it.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üéÇ",
                name: "Birthday Forgotten",
                situation: "You realize you completely forgot a close friend's birthday yesterday. They haven't mentioned it, but you know they were probably hurt.",
                choices: [
                    {
                        text: "Call them immediately, apologize sincerely, and plan a special belated celebration",
                        compassion: 18,
                        feedback: "Your friend appreciates your honesty and effort to make it right. Your genuine care and action mean more than a perfect memory.",
                        type: "positive"
                    },
                    {
                        text: "Send a quick apology text and promise to make it up",
                        compassion: 7,
                        feedback: "You acknowledged the mistake, but a phone call or in-person conversation would have shown more care.",
                        type: "neutral"
                    },
                    {
                        text: "Hope they don't bring it up and move on",
                        compassion: -4,
                        feedback: "Avoiding the issue doesn't make it go away. Your friend likely noticed and felt unimportant.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üìö",
                name: "Struggling Student",
                situation: "A younger student in the library looks overwhelmed with their homework. They keep sighing and seem on the verge of tears.",
                choices: [
                    {
                        text: "Approach them gently and offer to help explain the concepts they're struggling with",
                        compassion: 17,
                        feedback: "Your help and encouragement give them confidence. You've not only helped with homework but also shown them that asking for help is okay.",
                        type: "positive"
                    },
                    {
                        text: "Offer to share your notes but don't have time to explain",
                        compassion: 6,
                        feedback: "Sharing notes helps, but understanding comes from explanation. They appreciate the gesture though.",
                        type: "neutral"
                    },
                    {
                        text: "Ignore them and focus on your own work",
                        compassion: -3,
                        feedback: "You stayed focused, but you could have made a real difference in someone's day with just a few minutes of your time.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üõí",
                name: "Shopper in Need",
                situation: "You're at the checkout and the person in front of you realizes they're short on money. They're embarrassed and trying to decide what to put back.",
                choices: [
                    {
                        text: "Offer to pay the difference, making them feel comfortable about accepting help",
                        compassion: 21,
                        feedback: "Their relief and gratitude are overwhelming. Your kindness in that moment of embarrassment meant everything. You've shown true compassion.",
                        type: "positive"
                    },
                    {
                        text: "Offer to pay but make it obvious you're doing them a favor",
                        compassion: 10,
                        feedback: "You helped, but your attitude made them feel worse about needing help. Kindness should preserve dignity.",
                        type: "neutral"
                    },
                    {
                        text: "Look away and pretend you don't notice",
                        compassion: -4,
                        feedback: "You avoided an awkward situation, but someone needed help and you had the chance to make a real difference.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üé≠",
                name: "Performer Having a Bad Day",
                situation: "You're at a local talent show and a performer clearly makes a mistake. The audience is quiet, and the performer looks devastated on stage.",
                choices: [
                    {
                        text: "Start clapping enthusiastically and encourage others to show support",
                        compassion: 20,
                        feedback: "Your support turns the moment around. The performer finishes with confidence, and you've shown that compassion can transform failure into resilience.",
                        type: "positive"
                    },
                    {
                        text: "Clap politely but don't do anything special",
                        compassion: 5,
                        feedback: "You were respectful, but sometimes people need more than polite applause‚Äîthey need genuine encouragement.",
                        type: "neutral"
                    },
                    {
                        text: "Stay quiet and wait for it to be over",
                        compassion: -3,
                        feedback: "Your silence added to their embarrassment. A little encouragement could have changed everything for them.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üè•",
                name: "Hospital Visitor",
                situation: "You're visiting someone in the hospital and notice another patient in the room has no visitors. They look lonely and sad.",
                choices: [
                    {
                        text: "Strike up a friendly conversation and include them in your visit",
                        compassion: 23,
                        feedback: "Your kindness brings light to their day. Sometimes the smallest gestures of inclusion can mean the world to someone feeling alone.",
                        type: "positive"
                    },
                    {
                        text: "Smile and nod but focus on your own visit",
                        compassion: 6,
                        feedback: "You were friendly, but a few minutes of conversation could have made a huge difference to someone feeling isolated.",
                        type: "neutral"
                    },
                    {
                        text: "Ignore them and focus only on your visit",
                        compassion: -2,
                        feedback: "You completed your visit, but you missed an opportunity to brighten someone's difficult day with simple human connection.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üåô",
                name: "Night Shift Worker",
                situation: "You're at a late-night coffee shop and notice a tired-looking night shift worker who seems stressed. They're trying to study while working.",
                choices: [
                    {
                        text: "Buy them a coffee and offer encouragement, maybe help with a question if you can",
                        compassion: 19,
                        feedback: "Your gesture of support means the world to them. You've shown that someone sees their hard work and cares. Small acts of recognition matter.",
                        type: "positive"
                    },
                    {
                        text: "Give them an understanding smile",
                        compassion: 4,
                        feedback: "Your empathy is noticed, but sometimes people need more than acknowledgment‚Äîthey need practical support.",
                        type: "neutral"
                    },
                    {
                        text: "Mind your own business and focus on your work",
                        compassion: -2,
                        feedback: "You stayed focused, but you could have made someone's difficult night a little easier with a small gesture.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üéÅ",
                name: "Gift Exchange",
                situation: "During a gift exchange, someone receives a gift that's clearly not to their taste. They're trying to be polite but look disappointed.",
                choices: [
                    {
                        text: "Later, privately offer to trade or help them find something they'd actually enjoy, showing you noticed",
                        compassion: 17,
                        feedback: "Your thoughtfulness and discretion show real care. You've turned a disappointing moment into a positive experience while respecting everyone's feelings.",
                        type: "positive"
                    },
                    {
                        text: "Make a joke to lighten the mood",
                        compassion: 5,
                        feedback: "You tried to help, but humor might not address their actual disappointment. Sometimes people need practical help, not jokes.",
                        type: "neutral"
                    },
                    {
                        text: "Ignore it and assume they'll be fine",
                        compassion: -2,
                        feedback: "You didn't want to make it awkward, but sometimes the most compassionate thing is to notice and help, even quietly.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üöó",
                name: "Car Trouble",
                situation: "You see someone on the side of the road with car trouble. They're trying to change a tire but clearly struggling. You're running late.",
                choices: [
                    {
                        text: "Stop and help, even if it makes you late, ensuring they're safe",
                        compassion: 22,
                        feedback: "Your help gets them back on the road safely. Their gratitude is immense, and you know you did the right thing. Safety and kindness matter more than schedules.",
                        type: "positive"
                    },
                    {
                        text: "Stop briefly to check if they need help, then call roadside assistance",
                        compassion: 12,
                        feedback: "You ensured they got help, which is good. But sometimes people need more than a phone call‚Äîthey need someone to stay until help arrives.",
                        type: "neutral"
                    },
                    {
                        text: "Drive by, assuming someone else will help",
                        compassion: -5,
                        feedback: "You made it on time, but you can't shake the worry about that person on the side of the road. Sometimes compassion means stopping.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üì±",
                name: "Social Media Bullying",
                situation: "You notice someone in your online community is being bullied in comments. They're clearly hurt but trying to defend themselves alone.",
                choices: [
                    {
                        text: "Stand up for them publicly, report the bullies, and send them a private message of support",
                        compassion: 24,
                        feedback: "Your courage to stand up makes a real difference. The person feels supported and less alone. You've shown that compassion means taking action against injustice.",
                        type: "positive"
                    },
                    {
                        text: "Send them a private message of support but don't get involved publicly",
                        compassion: 10,
                        feedback: "Your private support helps, but sometimes people need public allies. Standing up together is more powerful than supporting in silence.",
                        type: "neutral"
                    },
                    {
                        text: "Stay out of it to avoid drama",
                        compassion: -4,
                        feedback: "You avoided conflict, but silence in the face of bullying can feel like approval. Sometimes compassion means getting involved.",
                        type: "negative"
                    }
                ]
            },
            {
                character: "üé®",
                name: "Artistic Friend",
                situation: "A friend shares their creative work with you, but it's clearly not very good. They're excited and asking for your honest opinion.",
                choices: [
                    {
                        text: "Find genuine things to praise, offer constructive feedback gently, and encourage their passion",
                        compassion: 18,
                        feedback: "Your balanced approach preserves their confidence while helping them grow. You've shown that compassion means being honest but kind, supporting their journey.",
                        type: "positive"
                    },
                    {
                        text: "Give vague praise to avoid hurting their feelings",
                        compassion: 6,
                        feedback: "You protected their feelings, but they can sense you're not being genuine. Honest, gentle feedback would have been more helpful.",
                        type: "neutral"
                    },
                    {
                        text: "Be brutally honest about how bad it is",
                        compassion: -6,
                        feedback: "Your honesty crushed their spirit. There's a difference between honesty and cruelty. Compassion means finding a way to be truthful without destroying someone's passion.",
                        type: "negative"
                    }
                ]
            }
                ],
                sl: [
                    {
                        character: "üë¥",
                        name: "Starej≈°i sosed",
                        situation: "Vidite svojega starej≈°ega soseda, ki muƒçno prena≈°a nakupovalne vreƒçke po stopnicah. ≈Ωe zamujate na sestanek.",
                        choices: [
                            {
                                text: "Ustavite se in pomagate prenesti nakupovalne vreƒçke, tudi ƒçe zaradi tega zamujate",
                                compassion: 15,
                                feedback: "Va≈° sosed je hvale≈æen in vi se poƒçutite dobro, ker ste pomagali. Vƒçasih je zamuda vredna, ko vas nekdo potrebuje.",
                                type: "positive"
                            },
                            {
                                text: "Hitro pomagate in razlo≈æite, da ste v naglici",
                                compassion: 8,
                                feedback: "Pomagali ste, vendar je va≈°a naglica na sosedu pustila uƒçinek, da se je poƒçutil kot breme. Nekaj dodatnih minut bi veliko pomenilo.",
                                type: "neutral"
                            },
                            {
                                text: "Delajte se, kot da niste videli, in nadaljujte svojo pot",
                                compassion: -5,
                                feedback: "Pri≈°li ste pravoƒçasno, vendar se ne morete znebiti obƒçutka, da ste zamudili prilo≈ænost pokazati prijaznost.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üòî",
                        name: "So≈°olec",
                        situation: "So≈°olec, ki obiƒçajno sedi sam, izgleda ≈æalosten. Opazite, da je ves teden tiho.",
                        choices: [
                            {
                                text: "Usedite se k njemu in vpra≈°ate, ali je vse v redu, in ga resniƒçno poslu≈°ate",
                                compassion: 20,
                                feedback: "Odpre se o obƒçutku osamljenosti. Va≈°a prijaznost vpliva nanj tako, da se poƒçuti videnega in cenjenega. Vzpostavili ste resniƒçno povezavo.",
                                type: "positive"
                            },
                            {
                                text: "Po≈°ljite hitro sporoƒçilo in vpra≈°ate, ali je vse v redu",
                                compassion: 5,
                                feedback: "Lepo je, vendar vƒçasih ljudje potrebujejo osebno povezavo. So≈°olec ceni vase dejanje, vendar se zdi, da bi vas bolj potreboval.",
                                type: "neutral"
                            },
                            {
                                text: "Predpostavite, da ≈æeli biti sam, zato ga ne motite",
                                compassion: -3,
                                feedback: "ƒåetudi se vƒçasih zdi, da ljudje ≈æelijo prostor, dejansko potrebujejo, da se nekdo oglasi. Zamudili ste prilo≈ænost pomagati.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üêï",
                        name: "Izgubljen pes",
                        situation: "Najdete izgubljenega psa, ki tava po ulici. Izgleda prestra≈°en in ima ovratnico, vendar ni vidnega lastnika v bli≈æini.",
                        choices: [
                            {
                                text: "Ostanite s psom, preverite etiketo in pomagate najti lastnika",
                                compassion: 18,
                                feedback: "Pove≈æete psa z njegovim zaskrbljenim lastnikom. Olaj≈°anje in hvale≈ænost v njegovih oƒçeh je neprecenljivo. Danes ste naredili resniƒçno razliko.",
                                type: "positive"
                            },
                            {
                                text: "Pokliƒçite slu≈æbo za ≈æivali in odidite",
                                compassion: 8,
                                feedback: "Naredili ste odgovorno stvar, vendar se pes zdi prestra≈°en. Lastnik bi bil morda v bli≈æini in bi ga hitreje na≈°el z va≈°o pomoƒçjo.",
                                type: "neutral"
                            },
                            {
                                text: "Ignorirajte ga in predpostavite, da bo nekdo drug pomagal",
                                compassion: -5,
                                feedback: "Od≈°li ste, vendar se ne morete znebiti razmi≈°ljanja, kaj se je zgodilo s tem prestra≈°enim psom. Soƒçutje pomeni ukrepanje.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üë®‚Äçüíº",
                        name: "Sodelavec v te≈æavah",
                        situation: "Sodelavec na delu izgleda preobremenjen s svojimi delovnimi obvzenostmi. Tudi vi imate svoje naloge za dokonƒçati.",
                        choices: [
                            {
                                text: "Ponudite pomoƒç pri nekaterih njegovih nalogah, tudi ƒçe to pomeni, da boste delali malo dlje",
                                compassion: 16,
                                feedback: "Sodelavec je neverjetno hvale≈æen. Timsko delo dodatno okrepi va≈° odnos in ustvari bolj podporno delovno okolje.",
                                type: "positive"
                            },
                            {
                                text: "Dajte mu nasvet o upravljanju ƒçasa",
                                compassion: 6,
                                feedback: " Sodelavec ceni va≈° nasvet, vendar pa ljudje vƒçasih potrebujejo praktiƒçno pomoƒç, ne le predloge.",
                                type: "neutral"
                            },
                            {
                                text: "Osredotoƒçite se na svoje delo in pustite, da se s tem ukvarja sam",
                                compassion: -2,
                                feedback: "Dokonƒçali ste svoje naloge, vendar opazite, da stres vpliva na celotno ekipo. Vƒçasih pomoƒç drugemu pomaga vsem.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üë∂",
                        name: "Mladi star≈°",
                        situation: "Ste v trgovini in vidite mladega star≈°a z jokajoƒçim dojenƒçkom, ki izgleda pod stresom med nakupovanjem. Drugi kupci ju gledajo zaniƒçljivo.",
                        choices: [
                            {
                                text: "Ponudite pomoƒç pri dr≈æanju otroka ali prena≈°anju ko≈°arice, pri ƒçemer poka≈æete razumevanje",
                                compassion: 20,
                                feedback: "Star≈° je ganjen do solz zaradi va≈°e prijaznosti. Va≈°e soƒçutje v tem trenutku stresa je pomenilo vse zanje.",
                                type: "positive"
                            },
                            {
                                text: "Dajte star≈°u razumevajoƒç nasmeh in nadaljujte",
                                compassion: 7,
                                feedback: "Va≈°a prijaznost je opa≈æena in cenjena, ƒçeprav bi praktiƒçna pomoƒç morda bila bolj pomembna.",
                                type: "neutral"
                            },
                            {
                                text: "Izognite se ju in nakupujte drugje, da pobegnete od hrupa",
                                compassion: -4,
                                feedback: "Izognili ste se situaciji, vendar je ta star≈° ƒçutil obsodbo drugih. Majhno dejanje prijaznosti bi lahko spremenilo njegov dan.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üéì",
                        name: "Nov uƒçenec",
                        situation: "Nov uƒçenec se je pravkar preselil na va≈°o ≈°olo. Izgleda izgubljen in nervozen, stoji sam med kosilom.",
                        choices: [
                            {
                                text: "Povabite ga, naj sedi z vami in va≈°imi prijatelji, da se poƒçuti dobrodo≈°lega",
                                compassion: 22,
                                feedback: "Naredili ste njegov prehod veliko la≈æji. Vedno se bo spomnil va≈°e prijaznosti. Pridobili ste novega prijatelja!",
                                type: "positive"
                            },
                            {
                                text: "Pozdravite, vendar ga ne povabite",
                                compassion: 4,
                                feedback: "Prijazna gesta, vendar je ≈°e vedno sam. Vƒçasih ljudje potrebujejo jasno povabilo, da se poƒçutijo dobrodo≈°li.",
                                type: "neutral"
                            },
                            {
                                text: "Pustite, da mu nekdo drug pomaga, vi ste zasedeni s prijatelji",
                                compassion: -3,
                                feedback: "Ostali ste v svoji coni udobja, vendar je ta nov uƒçenec pre≈æivel kosilo sam. Majhna gesta bi lahko naredila ogromno razliko.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üåßÔ∏è",
                        name: "Brezdomec",
                        situation: "Obidete nekoga, ki izgleda kot brezdomec, ki sedi na de≈æju. Ne prosi za niƒç, le posku≈°a ostati suh.",
                        choices: [
                            {
                                text: "Ponudite, da mu kupite topel obrok in poi≈°ƒçete informacije o zaveti≈°ƒçu",
                                compassion: 25,
                                feedback: "Va≈°a iskrena skrb in praktiƒçna pomoƒç obnovi njegovo upanje. Obravnavali ste ga z dostojanstvom in spo≈°tovanjem. To je resniƒçno soƒçutje.",
                                type: "positive"
                            },
                            {
                                text: "Dajte mu nekaj drobi≈æa",
                                compassion: 10,
                                feedback: "Va≈°a velikodu≈°nost pomaga, vendar morda potrebujejo veƒç kot denar. Kljub temu vsako dejanje prijaznosti ≈°teje.",
                                type: "neutral"
                            },
                            {
                                text: "Hitro preƒçite mimo, negotovi, kaj storiti",
                                compassion: -2,
                                feedback: "Poƒçutili ste se neudobno, kar je razumljivo. Vendar vƒçasih je najbolj soƒçutna stvar priznati ƒçlovekovo ƒçloveƒçnost.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üíî",
                        name: "Prijatelj v te≈æavah",
                        situation: "Bli≈ænji prijatelj pre≈æivlja te≈æko loƒçitev in zadnje ƒçase si ni podoben. Preklaplja naƒçrte.",
                        choices: [
                            {
                                text: "Pojavite se pri njemu z njegovo najljub≈°o hrano in samo bodite tam, da poslu≈°ate",
                                compassion: 24,
                                feedback: "Va≈° prijatelj se zlomi v solzah hvale≈ænosti. Vƒçasih ljudje potrebujejo, da se nekdo pojavi, ne da bi bili vpra≈°ani. Bili ste resniƒçen prijatelj.",
                                type: "positive"
                            },
                            {
                                text: "Redno po≈°iljajte sporoƒçila in preverjajte, kako je",
                                compassion: 12,
                                feedback: "Va≈°a dosledna skrb veliko pomeni, ƒçeprav vƒçasih ljudje v boleƒçini potrebujejo fiziƒçno prisotnost in povezavo.",
                                type: "neutral"
                            },
                            {
                                text: "Dajte mu prostor in poƒçakajte, da se oglasi",
                                compassion: 2,
                                feedback: "Spo≈°tovanje meja je pomembno, vendar vƒçasih ljudje, ki trpijo, potrebujejo, da se nekdo prvi oglasi.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üöå",
                        name: "Potnik v avtobusu",
                        situation: "Ste v polnem avtobusu in opazite starej≈°o osebo, ki stoji, medtem ko mlaj≈°i ljudje sedijo. Zdi se, da nihƒçe ne opazi ali skrbi.",
                        choices: [
                            {
                                text: "Takoj ponudite svoj sede≈æ in pomagate, da se oseba udobno usede",
                                compassion: 16,
                                feedback: "Starej≈°a oseba je globoko hvale≈æna. Va≈°a preprosta gesta spo≈°tovanja in prijaznosti razsvetli njen dan in postavi pozitiven primer za druge.",
                                type: "positive"
                            },
                            {
                                text: "Ponudite svoj sede≈æ, vendar se zdi malo nevoljno",
                                compassion: 8,
                                feedback: "Naredili ste pravo stvar, vendar je bila va≈°e oklevanje vidno. Iskrena prijaznost prihaja iz srca, ne iz obveznosti.",
                                type: "neutral"
                            },
                            {
                                text: "Poƒçakajte, da nekdo drug ponudi svoj sede≈æ",
                                compassion: -3,
                                feedback: "Poƒçakali ste, vendar nihƒçe drug ni stopil naprej. Vƒçasih je biti prvi, ki ukrepa, tisto, kar naredi razliko.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üåç",
                        name: "Mednarodni ≈°tudent",
                        situation: "Zdi se, da ima ≈°tudent iz druge dr≈æave izziv z jezikom in izgleda zmeden med skupinskim projektom. Drugi postajajo frustrirani zaradi njega.",
                        choices: [
                            {
                                text: "Potrpe≈æljivo mu pomagate razumeti, z uporabo preprostega jezika in vizualnih pripomoƒçkov",
                                compassion: 19,
                                feedback: "Va≈°a potrpe≈æljivost in razumevanje mu pomagata uspeti. Hvale≈æen je za va≈°o prijaznost in pridobili ste novega prijatelja iz druge kulture.",
                                type: "positive"
                            },
                            {
                                text: "Na hitro mu prevedite",
                                compassion: 9,
                                feedback: "Pomagali ste, vendar je va≈°a nepotrpe≈æljivost naredila, da se je poƒçutil kot breme. Malo veƒç potrpe≈æljivosti bi veliko pomenilo.",
                                type: "neutral"
                            },
                            {
                                text: "Pustite drugim, da se s tem ukvarjajo, in se osredotoƒçite na svoj del",
                                compassion: -2,
                                feedback: "Dokonƒçali ste svoje delo, vendar se je ≈°tudent poƒçutil izkljuƒçenega. Vkljuƒçevanje zahteva napor, vendar je vredno.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üéÇ",
                        name: "Pozabljen rojstni dan",
                        situation: "Ugotovite, da ste vƒçeraj popolnoma pozabili rojstni dan bli≈ænje prijateljice. Sicer vam tega sama ni omenila, vendar veste, da je bila zaradi tega verjetno prizadeta.",
                        choices: [
                            {
                                text: "Pokliƒçite jo takoj, se ji iskreno opraviƒçite in naƒçrtujte posebno zamujeno praznovanje",
                                compassion: 18,
                                feedback: "Va≈° prijateljica ceni iskrenost in napor, da to popravite. Va≈°a iskrena skrb in dejanje pomenita veƒç kot popoln spomin.",
                                type: "positive"
                            },
                            {
                                text: "Po≈°ljite ji hitro opraviƒçilo in obljubite, da boste to popravili",
                                compassion: 7,
                                feedback: "Priznali ste napako, vendar bi telefonski klic ali osebni pogovor izkazal veƒç skrbi.",
                                type: "neutral"
                            },
                            {
                                text: "Upajte, da tega ne omeni, in nadaljujte",
                                compassion: -4,
                                feedback: "Izogibanje problemu, te≈æave ne izniƒçi. Va≈° prijateljica se dobro zaveda va≈°ih ravnanj in se poƒçuti manjvredno.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üìö",
                        name: "≈†tudentka v te≈æavah",
                        situation: "Mlaj≈°a ≈°tudentka v knji≈ænici izgleda preobremenjena s svojo domaƒço nalogo. Vzdihuje in se zdi, da je na robu solz.",
                        choices: [
                            {
                                text: "Pristopite k njej ne≈æno in ponudite pomoƒç pri razlagi konceptov, s katerimi se muƒçi",
                                compassion: 17,
                                feedback: "Va≈°a pomoƒç in spodbuda ji daje zaupanje. Ne samo, da ste pomagali pri domaƒçi nalogi, temveƒç tudi, da je prositi za pomoƒç v redu.",
                                type: "positive"
                            },
                            {
                                text: "Ponudite deljenje zapiskov, vendar nimate ƒçasa za razlago",
                                compassion: 6,
                                feedback: "Deljenje zapiskov pomaga, vendar razumevanje prihaja iz razlage. ≈†tudentka vseeno ceni gesto.",
                                type: "neutral"
                            },
                            {
                                text: "Ignorirajte jo in se osredotoƒçite na svoje delo",
                                compassion: -3,
                                feedback: "Ostali ste osredotoƒçeni, vendar bi lahko z le nekaj minutami svojega ƒçasa naredili resniƒçno razliko v dnevu nekoga.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üõí",
                        name: "Kupovalka v stiski",
                        situation: "Ste na blagajni in oseba pred vami ugotovi, da ji primanjkuje denarja. Sramuje se in posku≈°a izbrati, kaj naj vrne.",
                        choices: [
                            {
                                text: "Ponudite, da plaƒçate razliko, da se poƒçuti udobno pri sprejemanju pomoƒçi",
                                compassion: 21,
                                feedback: "Njeno olaj≈°anje in hvale≈ænost sta premoƒçna. Va≈°a prijaznost v tem trenutku sramu je pomenila vse. Pokazali ste resniƒçno soƒçutje.",
                                type: "positive"
                            },
                            {
                                text: "Ponudite plaƒçilo, vendar oƒçitno poka≈æite, da jim delate uslugo",
                                compassion: 10,
                                feedback: "Pomagali ste, vendar je va≈° odnos naredil, da se je poƒçutila slab≈°e zaradi potrebe po pomoƒçi. Prijaznost bi morala ohraniti dostojanstvo.",
                                type: "neutral"
                            },
                            {
                                text: "Pogledate stran in se delate, da ne opazite",
                                compassion: -4,
                                feedback: "Izognili ste se neprijetni situaciji, vendar je nekdo potreboval pomoƒç in imeli ste prilo≈ænost narediti resniƒçno razliko.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üé≠",
                        name: "Izvajalec ima slab dan",
                        situation: "Ste na lokalni talentni oddaji in izvajalec oƒçitno naredi napako. Obƒçinstvo je tiho in izvajalec na odru izgleda uniƒçen.",
                        choices: [
                            {
                                text: "Zaƒçnite navdu≈°eno ploskati in spodbujajte druge, da poka≈æejo podporo",
                                compassion: 20,
                                feedback: "Va≈°a podpora obrne trenutek. Izvajalec konƒça z zaupanjem in pokazali ste, da lahko soƒçutje spremeni neuspeh v odpornost.",
                                type: "positive"
                            },
                            {
                                text: "Veselo ploskajte, vendar ne naredite niƒç posebnega",
                                compassion: 5,
                                feedback: "Bili ste spo≈°tljivi, vendar vƒçasih ljudje potrebujejo veƒç kot vljuden aplavz‚Äîpotrebujejo iskreno spodbudo.",
                                type: "neutral"
                            },
                            {
                                text: "Ostanite tiho in poƒçakajte, da se konƒça",
                                compassion: -3,
                                feedback: "Va≈°a ti≈°ina je dodala njegovi sramoti. Malo spodbude bi lahko spremenilo vse zanj.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üè•",
                        name: "Obiskovalec v bolni≈°nici",
                        situation: "Obiskujete nekoga v bolni≈°nici in opazite, da drugi bolnik v sobi nima obiskovalcev. Izgleda osamljeno in ≈æalostno.",
                        choices: [
                            {
                                text: "Zaƒçnite prijateljski pogovor in ga vkljuƒçite v svoj obisk",
                                compassion: 23,
                                feedback: "Va≈°a prijaznost prinese svetlobo v njegov dan. Vƒçasih lahko najmanj≈°e geste vkljuƒçevanja pomenijo svet nekomu, ki se poƒçuti osamljeno.",
                                type: "positive"
                            },
                            {
                                text: "Nasmehnite se in kimajte, vendar se osredotoƒçite na svoj obisk",
                                compassion: 6,
                                feedback: "Bili ste prijazni, vendar bi lahko nekaj minut pogovora naredilo ogromno razliko nekomu, ki se poƒçuti izolirano.",
                                type: "neutral"
                            },
                            {
                                text: "Ignorirajte ga in se osredotoƒçite le na svoj obisk",
                                compassion: -2,
                                feedback: "Dokonƒçali ste svoj obisk, vendar ste zamudili prilo≈ænost razsvetliti nekomu te≈æak dan s preprosto ƒçlove≈°ko povezavo.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üåô",
                        name: "Noƒçni delavec",
                        situation: "Ste v pozno noƒçni kavarni in opazite utrujenega noƒçnega delavca, ki izgleda pod stresom. Posku≈°a ≈°tudirati med delom.",
                        choices: [
                            {
                                text: "Kupite mu kavo in ponudite spodbudo, morda nagovorite z vpra≈°anjem o njemu",
                                compassion: 19,
                                feedback: "Va≈°a gesta podpore pomeni svet zanj. Pokazali ste, da nekdo vidi njegovo trdo delo in skrbi. Majhna dejanja priznanja ≈°tejejo.",
                                type: "positive"
                            },
                            {
                                text: "Dajte jim razumevajoƒç nasmeh",
                                compassion: 4,
                                feedback: "Va≈°a empatija je opa≈æena, vendar vƒçasih ljudje potrebujejo veƒç kot priznanje‚Äîpotrebujejo praktiƒçno podporo.",
                                type: "neutral"
                            },
                            {
                                text: "Posvetite se svoji stvari in se osredotoƒçite na svoje delo",
                                compassion: -2,
                                feedback: "Ostali ste osredotoƒçeni, vendar bi lahko z majhno gesto naredili nekomu te≈æko noƒç malo la≈æjo.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üéÅ",
                        name: "Izmenjava daril",
                        situation: "Med izmenjavo daril nekdo prejme darilo, ki oƒçitno ni po njegovem okusu. Posku≈°a biti vljuden, vendar izgleda razoƒçaran.",
                        choices: [
                            {
                                text: "Kasneje zasebno ponudite menjavo ali pomagajte najti nekaj, kar bi dejansko u≈æivali, pri ƒçemer poka≈æete, da ste opazili",
                                compassion: 17,
                                feedback: "Va≈°a premi≈°ljenost in diskrecija ka≈æeta resniƒçno skrb. Spremenili ste trenutek razoƒçaranja v pozitivno izku≈°njo, pri ƒçemer spo≈°tujete obƒçutke drugih.",
                                type: "positive"
                            },
                            {
                                text: "Naredite ≈°alo, da razbremenite vzdu≈°je",
                                compassion: 5,
                                feedback: "Posku≈°ali ste pomagati, vendar humor morda ne obravnava njegovega dejanskega razoƒçaranja. Vƒçasih ljudje potrebujejo praktiƒçno pomoƒç, ne ≈°ale.",
                                type: "neutral"
                            },
                            {
                                text: "Ignorirajte to in predpostavite, da bo vse v redu",
                                compassion: -2,
                                feedback: "Niste ≈æeleli narediti neprijetno, vendar vƒçasih je najbolj soƒçutna stvar opaziti in pomagati, tudi tiho.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üöó",
                        name: "Te≈æave z avtom",
                        situation: "Vidite nekoga ob cesti s te≈æavami z avtomobilom. Posku≈°a zamenjati pnevmatiko, vendar se oƒçitno muƒçi. Zamujate.",
                        choices: [
                            {
                                text: "Ustavite in pomagate, tudi ƒçe zaradi tega zamujate. Zagotovite, da je oseba varna",
                                compassion: 22,
                                feedback: "Va≈°a pomoƒç osebo vrne na cesto varno. Njena hvale≈ænost je ogromna in veste, da ste naredili pravo stvar. Varnost in prijaznost sta pomembnej≈°a od urnikov.",
                                type: "positive"
                            },
                            {
                                text: "Kratko se ustavite, da preverite, ali potrebuje pomoƒç, nato pokliƒçite pomoƒç ob cesti",
                                compassion: 12,
                                feedback: "Zagotovili ste, da je oseba dobila pomoƒç, kar je dobro. Vendar vƒçasih ljudje potrebujejo veƒç kot telefonski klic‚Äîpotrebujejo nekoga, ki ostane, dokler pomoƒç ne prispe.",
                                type: "neutral"
                            },
                            {
                                text: "Peljite mimo in predpostavite, da bo nekdo drug pomagal",
                                compassion: -5,
                                feedback: "Pri≈°li ste pravoƒçasno, vendar se ne morete znebiti skrbi za tisto osebo ob cesti. Vƒçasih soƒçutje pomeni ustaviti se.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üì±",
                        name: "Ustrahovanje na socialnih omre≈æjih",
                        situation: "Opazite, da nekdo v va≈°i spletni skupnosti do≈æivlja ustrahovanje v komentarjih. Oseba je oƒçitno prizadeta, vendar se posku≈°a braniti sama.",
                        choices: [
                            {
                                text: "Javno se postavite za to osebo, prijavite ustrahovalce in po≈°ljite zasebno sporoƒçilo podpore",
                                compassion: 24,
                                feedback: "Va≈° pogum, da se postavite, naredi resniƒçno razliko. Oseba se poƒçuti podprto in manj osamljeno. Pokazali ste, da soƒçutje pomeni ukrepanje proti krivici.",
                                type: "positive"
                            },
                            {
                                text: "Po≈°ljite ji zasebno sporoƒçilo podpore, vendar se javno ne vme≈°avajte",
                                compassion: 10,
                                feedback: "Va≈°a zasebna podpora pomaga, vendar vƒçasih ljudje potrebujejo javne zaveznike. Postaviti se skupaj je moƒçneje kot podpirati v ti≈°ini.",
                                type: "neutral"
                            },
                            {
                                text: "Ostanite zunaj tega, da se izognete drami",
                                compassion: -4,
                                feedback: "Izognili ste se konfliktu, vendar ti≈°ina ob ustrahovanju lahko izgleda kot odobravanje. Vƒçasih soƒçutje pomeni vme≈°avanje.",
                                type: "negative"
                            }
                        ]
                    },
                    {
                        character: "üé®",
                        name: "Umetni≈°ka prijateljica",
                        situation: "Prijateljica deli svoje ustvarjalno delo z vami, vendar oƒçitno ni zelo dobro. Navdu≈°ena je in prosi za va≈°e iskreno mnenje.",
                        choices: [
                            {
                                text: "Najdite iskrene stvari za pohvalo, ne≈æno ponudite konstruktivno povratno informacijo in spodbujajte njeno strast",
                                compassion: 18,
                                feedback: "Va≈° uravnote≈æen pristop ohranja njenjo zaupanje, medtem ko ji pomaga rasti. Pokazali ste, da soƒçutje pomeni biti prijazen, iskren in podporen.",
                                type: "positive"
                            },
                            {
                                text: "Dajte nejasno pohvalo, da ne ranite njenih obƒçutkov",
                                compassion: 6,
                                feedback: "Za≈°ƒçitili ste njene obƒçutke, vendar lahko ƒçuti, da niste iskreni. Iskrena, ne≈æna povratna informacija bi bila bolj koristna.",
                                type: "neutral"
                            },
                            {
                                text: "Bodite brutalno iskreni o tem, kako slabo je",
                                compassion: -6,
                                feedback: "Va≈°a iskrenost je uniƒçila njen duh. Obstaja razlika med iskrenostjo in arogantnostjo. Soƒçutje vƒçasih pomeni tudi najti naƒçin, kako biti iskren, ne da bi zatiral strasti drugih.",
                                type: "negative"
                            }
                        ]
                    }
                ]
            };
            return allScenariosData[lang] || allScenariosData.en;
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        const selfCompassionExercisePool = [
            // Existing writing exercises (text)
            {
                id: 'letter',
                type: 'text',
                titleKey: 'letterExerciseTitle',
                descriptionKey: 'letterExerciseDescription',
                placeholderKey: 'letterPlaceholder',
                pointsFull: 15,
                pointsEmpty: 5,
                continueKey: 'letterContinueBtn'
            },
            {
                id: 'gratitude',
                type: 'text',
                titleKey: 'gratitudeExerciseTitle',
                descriptionKey: 'gratitudeExerciseDescription',
                placeholderKey: 'gratitudePlaceholder',
                pointsFull: 15,
                pointsEmpty: 5,
                continueKey: 'gratitudeContinueBtn'
            },
            {
                id: 'mantra',
                type: 'text',
                titleKey: 'mantraExerciseTitle',
                descriptionKey: 'mantraExerciseDescription',
                placeholderKey: 'mantraPlaceholder',
                pointsFull: 15,
                pointsEmpty: 5,
                continueKey: 'mantraContinueBtn'
            },
            // New exercises (mixed)
            {
                id: 'supportive_touch',
                type: 'tap',
                titleKey: 'supportiveTouchTitle',
                descriptionKey: 'supportiveTouchDescription',
                actionBtnKey: 'supportiveTouchActionBtn',
                points: 10
            },
            {
                id: 'self_compassion_break',
                type: 'step',
                titleKey: 'selfCompassionBreakTitle',
                stepsKeys: ['selfCompassionBreakStep1', 'selfCompassionBreakStep2', 'selfCompassionBreakStep3'],
                nextBtnKey: 'selfCompassionBreakNextBtn',
                points: 10
            },
            {
                id: 'permission_slip',
                type: 'choice',
                titleKey: 'permissionSlipTitle',
                descriptionKey: 'permissionSlipDescription',
                optionsKeys: ['permissionSlipOption1', 'permissionSlipOption2', 'permissionSlipOption3', 'permissionSlipOption4'],
                points: 10
            },
            {
                id: 'inner_critic_reframe',
                type: 'choice',
                titleKey: 'innerCriticTitle',
                descriptionKey: 'innerCriticDescription',
                thoughtKey: 'innerCriticThought',
                optionsKeys: ['innerCriticOption1', 'innerCriticOption2', 'innerCriticOption3'],
                points: 10
            },
            {
                id: 'micro_gratitude_self',
                type: 'text',
                titleKey: 'microGratitudeSelfTitle',
                descriptionKey: 'microGratitudeSelfDescription',
                placeholderKey: 'microGratitudeSelfPlaceholder',
                pointsFull: 10,
                pointsEmpty: 5,
                continueKey: 'microGratitudeSelfContinueBtn'
            }
        ];

        function pickRandomSelfCompassionExercises(count) {
            return shuffleArray([...selfCompassionExercisePool]).slice(0, count);
        }

        function initGame() {
            compassionScore = 0;
            livesTouched = 0;
            currentScenario = 0;
            selfCompassionExercise = 0;
            quizActive = false;
            quizProgress = 0;
            document.getElementById('scenarioNumber').textContent = `1/${SCENARIOS_PER_GAME}`;
            document.getElementById('exercisesNumber').textContent = `0/4`;
            document.getElementById('quizNumber').textContent = `0/1`;
            document.getElementById('compassionQuiz').classList.add('hidden');
            // Randomize scenarios and select the number for this game
            const allScenarios = getScenariosForLanguage(currentLanguage);
            gameScenarios = shuffleArray(allScenarios).slice(0, SCENARIOS_PER_GAME);
            updateStats();
            showScenario();
        }

        function showScenario() {
            if (currentScenario >= gameScenarios.length) {
                endGame();
                return;
            }

            // Hide all other sections
            document.getElementById('scenariosComplete').classList.add('hidden');
            document.getElementById('selfCompassionTransition').classList.add('hidden');
            document.getElementById('selfCompassionSection').classList.add('hidden');
            document.getElementById('breathingExercise').classList.add('hidden');
            document.getElementById('letterExercise').classList.add('hidden');
            document.getElementById('gratitudeExercise').classList.add('hidden');
            document.getElementById('mantraExercise').classList.add('hidden');
            document.getElementById('compassionQuiz').classList.add('hidden');
            document.getElementById('scenario').classList.remove('hidden');

            const scenario = gameScenarios[currentScenario];
            const scenarioDiv = document.getElementById('scenario');
            
            // Shuffle choices randomly
            const shuffledChoices = shuffleArray([...scenario.choices]);
            // Create mapping: newIndex -> originalIndex
            const choiceMapping = shuffledChoices.map(shuffledChoice => 
                scenario.choices.findIndex(originalChoice => originalChoice === shuffledChoice)
            );
            // Store mapping for this scenario
            scenario._choiceMapping = choiceMapping;
            
            scenarioDiv.innerHTML = `
                <div class="character">
                    <div class="character-avatar">${scenario.character}</div>
                    <div class="character-info">
                        <h3>${scenario.name}</h3>
                        <p class="scenario-text">${scenario.situation}</p>
                    </div>
                </div>
                <div class="choices">
                    ${shuffledChoices.map((choice, index) => 
                        `<button class="choice-btn" onclick="makeChoice(${index})">${choice.text}</button>`
                    ).join('')}
                </div>
                <div id="feedback"></div>
            `;

            updateProgress();
        }

        function makeChoice(choiceIndex) {
            const scenario = gameScenarios[currentScenario];
            // Map shuffled index back to original index
            const originalIndex = scenario._choiceMapping ? scenario._choiceMapping[choiceIndex] : choiceIndex;
            const choice = scenario.choices[originalIndex];
            
            // Disable all buttons
            document.querySelectorAll('.choice-btn').forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.6';
            });

            // Update scores
            compassionScore += choice.compassion;
            let livesAdded = 0;
            if (choice.compassion > 10) {
                // Special case: Lost Dog scenario - best choice touches both dog and owner (2 lives)
                const scenarioName = scenario.name;
                const isLostDogScenario = scenarioName === "Izgubljen pes" || scenarioName === "Lost Dog";
                // Check if this is the best choice (compassion: 18, type: positive)
                if (isLostDogScenario && choice.compassion === 18 && choice.type === "positive") {
                    livesTouched += 2;
                    livesAdded = 2;
                } else {
                    livesTouched++;
                    livesAdded = 1;
                }
            }

            // Show feedback
            const feedbackDiv = document.getElementById('feedback');
            const t = translations[currentLanguage];
            feedbackDiv.innerHTML = `
                <div class="feedback ${choice.type}">
                    <strong>${choice.feedback}</strong>
                    ${choice.compassion > 0 ? `<div style="margin-top: 10px;">+${choice.compassion} ${t.points}</div>` : ''}
                    ${livesAdded > 0 ? `<div style="margin-top: 5px;">+${livesAdded} ${t.livesTouched}</div>` : ''}
                    <button class="ok-btn" onclick="nextScenario()">${t.ok}</button>
                </div>
            `;

            updateStats();
        }

        function nextScenario() {
            currentScenario++;
            // After 8 scenarios (currentScenario === 8 means we've done 0-7, now showing completion)
            if (currentScenario === 8) {
                showScenariosComplete();
            } else {
                showScenario();
            }
        }

        function showScenariosComplete() {
            const t = translations[currentLanguage];
            // Hide all other sections
            document.getElementById('scenario').classList.add('hidden');
            document.getElementById('selfCompassionTransition').classList.add('hidden');
            document.getElementById('selfCompassionSection').classList.add('hidden');
            document.getElementById('breathingExercise').classList.add('hidden');
            document.getElementById('letterExercise').classList.add('hidden');
            document.getElementById('gratitudeExercise').classList.add('hidden');
            document.getElementById('mantraExercise').classList.add('hidden');
            document.getElementById('compassionQuiz').classList.add('hidden');
            document.getElementById('scenariosComplete').classList.remove('hidden');

            // We've completed all scenarios; show 100% progress
            updateProgress();
            
            const completeDiv = document.getElementById('scenariosComplete');
            const message = typeof t.scenariosCompleteMessage === 'function' 
                ? t.scenariosCompleteMessage(compassionScore, livesTouched)
                : t.scenariosCompleteMessage;
            completeDiv.innerHTML = `
                <h2>${t.scenariosCompleteTitle}</h2>
                <div class="result-box">
                    <p style="font-size: 1.2em; margin-bottom: 20px;">${message}</p>
                </div>
                <button class="start-game-btn" onclick="showSelfCompassionTransition()">${t.transitionToSelfCompassion}</button>
            `;
        }

        function showSelfCompassionTransition() {
            const t = translations[currentLanguage];
            // Hide all other sections
            document.getElementById('scenario').classList.add('hidden');
            document.getElementById('scenariosComplete').classList.add('hidden');
            document.getElementById('selfCompassionSection').classList.add('hidden');
            document.getElementById('breathingExercise').classList.add('hidden');
            document.getElementById('letterExercise').classList.add('hidden');
            document.getElementById('gratitudeExercise').classList.add('hidden');
            document.getElementById('mantraExercise').classList.add('hidden');
            document.getElementById('compassionQuiz').classList.add('hidden');
            document.getElementById('selfCompassionTransition').classList.remove('hidden');
            
            // Don't reset progress bar yet - wait until first exercise starts
            // Keep progress at 100% (scenarios complete) until first exercise begins
            
            const transitionDiv = document.getElementById('selfCompassionTransition');
            transitionDiv.innerHTML = `
                <h2>${t.selfCompassionPartTitle}</h2>
                <p>${t.transitionToSelfCompassion}</p>
                <button class="start-game-btn" onclick="showSelfCompassionIntro()">${t.startGame}</button>
            `;
        }

        function showSelfCompassionIntro() {
            const t = translations[currentLanguage];
            // Hide all other sections
            document.getElementById('scenario').classList.add('hidden');
            document.getElementById('scenariosComplete').classList.add('hidden');
            document.getElementById('selfCompassionTransition').classList.add('hidden');
            document.getElementById('breathingExercise').classList.add('hidden');
            document.getElementById('letterExercise').classList.add('hidden');
            document.getElementById('gratitudeExercise').classList.add('hidden');
            document.getElementById('mantraExercise').classList.add('hidden');
            document.getElementById('compassionQuiz').classList.add('hidden');
            document.getElementById('selfCompassionSection').classList.remove('hidden');
            
            // Reset progress bar for self-compassion exercises (0% - not started yet)
            selfCompassionExercise = 0;
            quizActive = false;
            quizProgress = 0;
            // Pick 3 random self-compassion exercises (breathing is always first)
            selectedSelfCompassionExercises = pickRandomSelfCompassionExercises(3);
            currentSelfCompassionIndex = 0;
            updateProgress();
            updateStats(); // Update stats to show exercises instead of scenario
            
            const section = document.getElementById('selfCompassionSection');
            const whatTitle = currentLanguage === 'sl' ? 'Kaj je samosoƒçutje?' : 'What is Self-Compassion?';
            const whyTitle = currentLanguage === 'sl' ? 'Zakaj je samosoƒçutje pomembno?' : 'Why is Self-Compassion Important?';
            
            section.innerHTML = `
                <h2>${t.selfCompassionTitle}</h2>
                
                <div class="self-compassion-content">
                    <h3>${whatTitle}</h3>
                    <p>${t.selfCompassionWhat}</p>
                </div>

                <div class="self-compassion-content">
                    <h3>${whyTitle}</h3>
                    <p>${t.selfCompassionWhy}</p>
                    <ul>
                        ${t.selfCompassionWhyList.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                </div>

                <div class="breathing-description">
                    <h3>${t.breathingExerciseTitle}</h3>
                    <p>${t.breathingExerciseDescription}</p>
                </div>

                <button class="start-game-btn" onclick="startBreathingExercise()">${t.breathingStartBtn}</button>
            `;
        }

        let breathingInterval = null;
        let breathingTimeout = null;
        let currentRound = 0;
        let currentPhase = 'inhale'; // 'inhale', 'hold', 'exhale'
        let currentSecond = 4;

        function setBreathingRingProgress(progress01) {
            const progressCircle = document.getElementById('breathingRingProgress');
            if (!progressCircle) return;

            const clamped = Math.max(0, Math.min(1, progress01));
            const radius = 46;
            const circumference = 2 * Math.PI * radius;
            progressCircle.style.strokeDasharray = `${circumference}`;
            progressCircle.style.strokeDashoffset = `${circumference * (1 - clamped)}`;
        }

        function setBreathingRingActive(active) {
            const ring = document.getElementById('breathingRing');
            if (!ring) return;
            ring.classList.toggle('active', active);
            if (!active) {
                setBreathingRingProgress(0);
            }
        }

        function startBreathingExercise() {
            const t = translations[currentLanguage];
            document.getElementById('selfCompassionSection').classList.add('hidden');
            document.getElementById('breathingExercise').classList.remove('hidden');
            
            // Mark first self-compassion exercise as started
            selfCompassionExercise = 1;
            updateProgress();
            updateStats();
            
            currentRound = 0;
            currentPhase = 'inhale';
            currentSecond = 4;
            
            const exerciseDiv = document.getElementById('breathingExercise');
            exerciseDiv.innerHTML = `
                <h2>${t.breathingExerciseTitle}</h2>
                <div class="breathing-container">
                    <svg class="breathing-ring" id="breathingRing" viewBox="0 0 100 100" aria-hidden="true">
                        <circle class="breathing-ring-track" cx="50" cy="50" r="46"></circle>
                        <circle class="breathing-ring-progress" id="breathingRingProgress" cx="50" cy="50" r="46"></circle>
                    </svg>
                    <div class="breathing-circle" id="breathingCircle"></div>
                    <div class="breathing-counter" id="breathingCounter">4</div>
                </div>
                <div class="breathing-phase" id="breathingPhase">${t.breathingInhale}</div>
                <div class="breathing-repeat-counter" id="breathingRepeatCounter">${t.breathingRepeat} 1/4</div>
                <button class="skip-btn" onclick="skipBreathingExercise()" style="margin-top: 20px;">${t.breathingSkipBtn}</button>
            `;
            
            startBreathingPhase();
        }

        function startBreathingPhase() {
            const t = translations[currentLanguage];
            const circle = document.getElementById('breathingCircle');
            const counter = document.getElementById('breathingCounter');
            const phase = document.getElementById('breathingPhase');
            const repeatCounter = document.getElementById('breathingRepeatCounter');
            
            // Remove all classes
            circle.classList.remove('inhale', 'hold', 'exhale');
            
            // Set current phase and duration
            let duration = 4; // default
            if (currentPhase === 'inhale') {
                phase.textContent = t.breathingInhale;
                circle.classList.add('inhale');
                duration = 4;
                setBreathingRingActive(false);
            } else if (currentPhase === 'hold') {
                phase.textContent = t.breathingHold;
                circle.classList.add('hold');
                duration = 7;
                setBreathingRingActive(true);
                setBreathingRingProgress(0);
            } else if (currentPhase === 'exhale') {
                phase.textContent = t.breathingExhale;
                circle.classList.add('exhale');
                duration = 8;
                setBreathingRingActive(false);
            }
            
            currentSecond = duration;
            counter.textContent = currentSecond;

            const phaseDuration = duration;
            
            breathingInterval = setInterval(() => {
                currentSecond--;
                counter.textContent = currentSecond;

                // Fill ring only during hold phase
                if (currentPhase === 'hold') {
                    setBreathingRingProgress((phaseDuration - currentSecond) / phaseDuration);
                }
                
                if (currentSecond <= 0) {
                    if (currentPhase === 'hold') {
                        setBreathingRingProgress(1);
                    }
                    clearInterval(breathingInterval);
                    moveToNextPhase();
                }
            }, 1000);
        }

        function moveToNextPhase() {
            const t = translations[currentLanguage];
            
            if (currentPhase === 'inhale') {
                currentPhase = 'hold';
                startBreathingPhase();
            } else if (currentPhase === 'hold') {
                currentPhase = 'exhale';
                startBreathingPhase();
            } else if (currentPhase === 'exhale') {
                currentRound++;
                
                if (currentRound < 4) {
                    currentPhase = 'inhale';
                    document.getElementById('breathingRepeatCounter').textContent = `${t.breathingRepeat} ${currentRound + 1}/4`;
                    startBreathingPhase();
                } else {
                    completeBreathingExercise();
                }
            }
        }

        function completeBreathingExercise() {
            const t = translations[currentLanguage];
            const exerciseDiv = document.getElementById('breathingExercise');
            
            // Award points for completing breathing exercise (no life yet - only at the end)
            compassionScore += 20;
            updateStats();
            
            exerciseDiv.innerHTML = `
                <h2>${t.breathingExerciseTitle}</h2>
                <div class="breathing-complete">
                    <strong>${t.breathingComplete}</strong>
                </div>
                <div class="feedback positive" style="margin-top: 20px;">
                    <div style="margin-top: 10px;">+20 ${t.points}</div>
                </div>
                <button class="start-game-btn" onclick="continueAfterBreathing()" style="margin-top: 20px;">${t.breathingContinueBtn}</button>
            `;
        }

        function continueAfterBreathing() {
            // Clear any intervals if still running
            if (breathingInterval) {
                clearInterval(breathingInterval);
            }
            if (breathingTimeout) {
                clearTimeout(breathingTimeout);
            }
            
            document.getElementById('breathingExercise').classList.add('hidden');
            // After breathing exercise, show a random self-compassion exercise
            showNextSelfCompassionExercise();
        }

        function skipBreathingExercise() {
            const t = translations[currentLanguage];
            
            // Clear any intervals if still running
            if (breathingInterval) {
                clearInterval(breathingInterval);
            }
            if (breathingTimeout) {
                clearTimeout(breathingTimeout);
            }
            
            // Award points for self-care (less than completing, but still acknowledging)
            compassionScore += 10;
            updateStats();
            
            const exerciseDiv = document.getElementById('breathingExercise');
            exerciseDiv.innerHTML = `
                <h2>${t.breathingSkipTitle}</h2>
                <div class="breathing-complete" style="background: #e7f3ff; border-left-color: #667eea; color: #004085;">
                    <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 20px;">${t.breathingSkipMessage}</p>
                    <p style="font-weight: bold; margin-bottom: 10px;">${t.breathingSkipAlternative}</p>
                    <ul style="text-align: left; margin-left: 20px; line-height: 1.8;">
                        ${t.breathingSkipAlternatives.map(alt => `<li>${alt}</li>`).join('')}
                    </ul>
                </div>
                <div class="feedback positive" style="margin-top: 20px;">
                    <div style="margin-top: 10px;">+10 ${t.points}</div>
                </div>
                <button class="start-game-btn" onclick="continueAfterBreathing()" style="margin-top: 20px;">${t.breathingSkipContinue}</button>
            `;
        }

        let activeSelfCompassionStepIndex = 0;

        function showNextSelfCompassionExercise() {
            const t = translations[currentLanguage];

            // Safety: if something cleared selection, recreate it
            if (!Array.isArray(selectedSelfCompassionExercises) || selectedSelfCompassionExercises.length !== 3) {
                selectedSelfCompassionExercises = pickRandomSelfCompassionExercises(3);
            }
            if (currentSelfCompassionIndex < 0) currentSelfCompassionIndex = 0;

            const ex = selectedSelfCompassionExercises[currentSelfCompassionIndex];
            if (!ex) {
                // No more exercises; go to quiz
                showSelfCompassionEndBeforeQuiz();
                return;
            }

            // Hide all other sections
            document.getElementById('scenario').classList.add('hidden');
            document.getElementById('scenariosComplete').classList.add('hidden');
            document.getElementById('selfCompassionTransition').classList.add('hidden');
            document.getElementById('selfCompassionSection').classList.add('hidden');
            document.getElementById('breathingExercise').classList.add('hidden');
            document.getElementById('gratitudeExercise').classList.add('hidden');
            document.getElementById('mantraExercise').classList.add('hidden');
            document.getElementById('compassionQuiz').classList.add('hidden');
            document.getElementById('letterExercise').classList.remove('hidden');

            // Mark self-compassion exercise step (2..4)
            selfCompassionExercise = Math.min(4, 2 + currentSelfCompassionIndex);
            updateProgress();
            updateStats();

            const container = document.getElementById('letterExercise');
            const title = t[ex.titleKey] || '';

            if (ex.type === 'text') {
                const description = t[ex.descriptionKey] || '';
                const placeholder = t[ex.placeholderKey] || '';
                const btnText = t[ex.continueKey] || t.startGame;
                container.innerHTML = `
                    <h2>${title}</h2>
                    <div class="exercise-description">
                        <p>${description}</p>
                    </div>
                    <textarea class="exercise-textarea" id="selfCompassionText" placeholder="${placeholder}"></textarea>
                    <button class="start-game-btn" onclick="completeCurrentSelfCompassionText()">${btnText}</button>
                `;
                return;
            }

            if (ex.type === 'tap') {
                const description = t[ex.descriptionKey] || '';
                const actionBtn = t[ex.actionBtnKey] || t.startGame;
                container.innerHTML = `
                    <h2>${title}</h2>
                    <div class="exercise-description">
                        <p>${description}</p>
                    </div>
                    <button class="start-game-btn" onclick="completeCurrentSelfCompassionFixed(${ex.points})">${actionBtn}</button>
                `;
                return;
            }

            if (ex.type === 'choice') {
                const description = t[ex.descriptionKey] || '';
                const thought = ex.thoughtKey ? (t[ex.thoughtKey] || '') : '';
                const options = (ex.optionsKeys || []).map((k) => t[k]).filter(Boolean);
                container.innerHTML = `
                    <h2>${title}</h2>
                    <div class="exercise-description">
                        ${description ? `<p>${description}</p>` : ''}
                        ${thought ? `<p style="margin-top: 10px; font-weight: bold;">${thought}</p>` : ''}
                    </div>
                    <div class="choices">
                        ${options.map((opt, i) => `<button class="choice-btn" onclick="completeCurrentSelfCompassionFixed(${ex.points})">${opt}</button>`).join('')}
                    </div>
                `;
                return;
            }

            if (ex.type === 'step') {
                activeSelfCompassionStepIndex = 0;
                const steps = (ex.stepsKeys || []).map((k) => t[k]).filter(Boolean);
                const nextBtn = t[ex.nextBtnKey] || t.ok;
                container.innerHTML = `
                    <h2>${title}</h2>
                    <div class="exercise-description">
                        <p id="selfCompassionStepText">${steps[0] || ''}</p>
                    </div>
                    <button class="start-game-btn" onclick="advanceSelfCompassionStep()">${nextBtn}</button>
                `;
                return;
            }
        }

        function completeCurrentSelfCompassionText() {
            const ex = selectedSelfCompassionExercises[currentSelfCompassionIndex];
            if (!ex || ex.type !== 'text') return;

            const t = translations[currentLanguage];
            const text = document.getElementById('selfCompassionText')?.value ?? '';
            const hasText = text.trim().length > 0;
            const pointsEarned = hasText ? ex.pointsFull : ex.pointsEmpty;
            compassionScore += pointsEarned;
            updateStats();

            showSelfCompassionExerciseComplete(hasText ? t.exerciseComplete : t.exerciseCompleteMental, pointsEarned);
        }

        function completeCurrentSelfCompassionFixed(pointsEarned) {
            const t = translations[currentLanguage];
            compassionScore += pointsEarned;
            updateStats();
            showSelfCompassionExerciseComplete(t.exerciseComplete, pointsEarned);
        }

        function advanceSelfCompassionStep() {
            const ex = selectedSelfCompassionExercises[currentSelfCompassionIndex];
            if (!ex || ex.type !== 'step') return;
            const t = translations[currentLanguage];
            const steps = (ex.stepsKeys || []).map((k) => t[k]).filter(Boolean);

            activeSelfCompassionStepIndex++;
            if (activeSelfCompassionStepIndex >= steps.length) {
                completeCurrentSelfCompassionFixed(ex.points);
                return;
            }

            const stepEl = document.getElementById('selfCompassionStepText');
            if (stepEl) stepEl.textContent = steps[activeSelfCompassionStepIndex] || '';
        }

        function showSelfCompassionExerciseComplete(message, pointsEarned) {
            const t = translations[currentLanguage];
            const container = document.getElementById('letterExercise');

            const ex = selectedSelfCompassionExercises[currentSelfCompassionIndex];
            const title = ex && ex.titleKey && t[ex.titleKey] ? t[ex.titleKey] : t.selfCompassionPartTitle;
            const isLast = currentSelfCompassionIndex >= 2;
            const nextLabel = isLast ? t.continueToQuizBtn : (t.breathingContinueBtn || t.startGame);
            const nextOnClick = isLast ? 'showSelfCompassionEndBeforeQuiz()' : 'goToNextSelfCompassionExercise()';

            container.innerHTML = `
                <h2>${title}</h2>
                <div class="breathing-complete">
                    <strong>${message}</strong>
                </div>
                <div class="feedback positive" style="margin-top: 20px;">
                    <div style="margin-top: 10px;">+${pointsEarned} ${t.points}</div>
                </div>
                <button class="start-game-btn" onclick="${nextOnClick}" style="margin-top: 20px;">${nextLabel}</button>
            `;
        }

        function goToNextSelfCompassionExercise() {
            currentSelfCompassionIndex++;
            showNextSelfCompassionExercise();
        }

        function showSelfCompassionEndBeforeQuiz() {
            const t = translations[currentLanguage];

            // Finish exercises (4/4)
            selfCompassionExercise = 4;
            // Count your own life once at the end of self-compassion section
            livesTouched++;

            // Reset progress for the quiz phase (0% until quiz submit)
            quizActive = true;
            quizProgress = 0;
            updateStats();
            updateProgress();

            const container = document.getElementById('letterExercise');
            container.innerHTML = `
                <h2>${t.selfCompassionPartTitle}</h2>
                <div class="breathing-complete">
                    <strong>${t.exerciseComplete}</strong>
                </div>
                <div class="feedback positive" style="margin-top: 20px;">
                    <div style="margin-top: 5px;">+1 ${t.livesTouched}</div>
                </div>
                <button class="start-game-btn" onclick="showCompassionQuiz()" style="margin-top: 20px;">${t.continueToQuizBtn}</button>
            `;
        }

        function showLetterExercise() {
            const t = translations[currentLanguage];
            // Hide all other sections
            document.getElementById('scenario').classList.add('hidden');
            document.getElementById('scenariosComplete').classList.add('hidden');
            document.getElementById('selfCompassionTransition').classList.add('hidden');
            document.getElementById('selfCompassionSection').classList.add('hidden');
            document.getElementById('breathingExercise').classList.add('hidden');
            document.getElementById('gratitudeExercise').classList.add('hidden');
            document.getElementById('mantraExercise').classList.add('hidden');
            document.getElementById('compassionQuiz').classList.add('hidden');
            document.getElementById('letterExercise').classList.remove('hidden');
            
            // Mark second self-compassion exercise as started
            selfCompassionExercise = 2;
            updateProgress();
            updateStats();
            
            const letterDiv = document.getElementById('letterExercise');
            letterDiv.innerHTML = `
                <h2>${t.letterExerciseTitle}</h2>
                <div class="exercise-description">
                    <p>${t.letterExerciseDescription}</p>
                </div>
                <textarea class="exercise-textarea" id="letterText" placeholder="${t.letterPlaceholder}"></textarea>
                <button class="start-game-btn" onclick="continueAfterLetter()">${t.letterContinueBtn}</button>
            `;
        }

        function continueAfterLetter() {
            const t = translations[currentLanguage];
            // Store the letter text (optional, for future use)
            const letterText = document.getElementById('letterText')?.value ?? '';
            const hasText = letterText.trim().length > 0;
            const pointsEarned = hasText ? 15 : 5;
            // Award points for completing the exercise (no life yet - only at the end)
            compassionScore += pointsEarned;
            updateStats();
            
            const letterDiv = document.getElementById('letterExercise');
            letterDiv.innerHTML = `
                <h2>${t.letterExerciseTitle}</h2>
                <div class="breathing-complete">
                    <strong>${hasText ? t.exerciseComplete : t.exerciseCompleteMental}</strong>
                </div>
                <div class="feedback positive" style="margin-top: 20px;">
                    <div style="margin-top: 10px;">+${pointsEarned} ${t.points}</div>
                </div>
                <button class="start-game-btn" onclick="showGratitudeExercise()" style="margin-top: 20px;">${t.letterContinueBtn}</button>
            `;
        }

        function showGratitudeExercise() {
            const t = translations[currentLanguage];
            // Hide all other sections
            document.getElementById('scenario').classList.add('hidden');
            document.getElementById('scenariosComplete').classList.add('hidden');
            document.getElementById('selfCompassionTransition').classList.add('hidden');
            document.getElementById('selfCompassionSection').classList.add('hidden');
            document.getElementById('breathingExercise').classList.add('hidden');
            document.getElementById('letterExercise').classList.add('hidden');
            document.getElementById('mantraExercise').classList.add('hidden');
            document.getElementById('compassionQuiz').classList.add('hidden');
            document.getElementById('gratitudeExercise').classList.remove('hidden');
            
            // Mark third self-compassion exercise as started
            selfCompassionExercise = 3;
            updateProgress();
            updateStats();
            
            const gratitudeDiv = document.getElementById('gratitudeExercise');
            gratitudeDiv.innerHTML = `
                <h2>${t.gratitudeExerciseTitle}</h2>
                <div class="exercise-description">
                    <p>${t.gratitudeExerciseDescription}</p>
                </div>
                <textarea class="exercise-textarea" id="gratitudeText" placeholder="${t.gratitudePlaceholder}"></textarea>
                <button class="start-game-btn" onclick="continueAfterGratitude()">${t.gratitudeContinueBtn}</button>
            `;
        }

        function continueAfterGratitude() {
            const t = translations[currentLanguage];
            // Store the gratitude text (optional, for future use)
            const gratitudeText = document.getElementById('gratitudeText')?.value ?? '';
            const hasText = gratitudeText.trim().length > 0;
            const pointsEarned = hasText ? 15 : 5;
            // Award points for completing the exercise (no life yet - only at the end)
            compassionScore += pointsEarned;
            updateStats();
            
            const gratitudeDiv = document.getElementById('gratitudeExercise');
            gratitudeDiv.innerHTML = `
                <h2>${t.gratitudeExerciseTitle}</h2>
                <div class="breathing-complete">
                    <strong>${hasText ? t.exerciseComplete : t.exerciseCompleteMental}</strong>
                </div>
                <div class="feedback positive" style="margin-top: 20px;">
                    <div style="margin-top: 10px;">+${pointsEarned} ${t.points}</div>
                </div>
                <button class="start-game-btn" onclick="showMantraExercise()" style="margin-top: 20px;">${t.gratitudeContinueBtn}</button>
            `;
        }

        function showMantraExercise() {
            const t = translations[currentLanguage];
            // Hide all other sections
            document.getElementById('scenario').classList.add('hidden');
            document.getElementById('scenariosComplete').classList.add('hidden');
            document.getElementById('selfCompassionTransition').classList.add('hidden');
            document.getElementById('selfCompassionSection').classList.add('hidden');
            document.getElementById('breathingExercise').classList.add('hidden');
            document.getElementById('letterExercise').classList.add('hidden');
            document.getElementById('gratitudeExercise').classList.add('hidden');
            document.getElementById('compassionQuiz').classList.add('hidden');
            document.getElementById('mantraExercise').classList.remove('hidden');
            
            // Mark fourth self-compassion exercise as started
            selfCompassionExercise = 4;
            updateProgress();
            updateStats();
            
            const mantraDiv = document.getElementById('mantraExercise');
            mantraDiv.innerHTML = `
                <h2>${t.mantraExerciseTitle}</h2>
                <div class="exercise-description">
                    <p>${t.mantraExerciseDescription}</p>
                </div>
                <textarea class="exercise-textarea" id="mantraText" placeholder="${t.mantraPlaceholder}"></textarea>
                <button class="start-game-btn" onclick="continueAfterMantra()">${t.mantraContinueBtn}</button>
            `;
        }

        function continueAfterMantra() {
            const t = translations[currentLanguage];
            // Store the mantra text (optional, for future use)
            const mantraText = document.getElementById('mantraText')?.value ?? '';
            const hasText = mantraText.trim().length > 0;
            const pointsEarned = hasText ? 15 : 5;
            // Award points for completing the exercise
            compassionScore += pointsEarned;
            // Add 1 life only at the end after all three exercises (your own life)
            livesTouched++;
            updateStats();

            // We're done with exercises; reset progress for the final quiz phase
            quizActive = true;
            quizProgress = 0;
            updateProgress();
            
            const mantraDiv = document.getElementById('mantraExercise');
            mantraDiv.innerHTML = `
                <h2>${t.mantraExerciseTitle}</h2>
                <div class="breathing-complete">
                    <strong>${hasText ? t.exerciseComplete : t.exerciseCompleteMental}</strong>
                </div>
                <div class="feedback positive" style="margin-top: 20px;">
                    <div style="margin-top: 10px;">+${pointsEarned} ${t.points}</div>
                    <div style="margin-top: 5px;">+1 ${t.livesTouched}</div>
                </div>
                <button class="start-game-btn" onclick="showCompassionQuiz()" style="margin-top: 20px;">${t.continueToQuizBtn}</button>
            `;
        }

        function updateUI() {
            const t = translations[currentLanguage];
            document.getElementById('gameTitle').textContent = t.title;
            document.getElementById('gameSubtitle').textContent = t.subtitle;
            document.getElementById('statCompassion').textContent = t.compassionScore;
            document.getElementById('statLives').textContent = t.livesTouched;
            document.getElementById('statScenario').textContent = t.scenario;
            document.getElementById('statExercises').textContent = t.exercises;
            document.getElementById('statQuiz').textContent = t.quiz;
            document.getElementById('gameOverTitle').textContent = t.gameOverTitle;
            document.getElementById('gameOverMessage').textContent = t.gameOverMessage;
            document.getElementById('restartBtn').textContent = t.playAgain;
            
            // Update tutorial
            document.getElementById('tutorialTitle').textContent = t.tutorialTitle;
            document.getElementById('tutorialWhatTitle').textContent = t.tutorialWhatTitle;
            document.getElementById('tutorialWhatText').textContent = t.tutorialWhatText;
            document.getElementById('tutorialWhyTitle').textContent = t.tutorialWhyTitle;
            document.getElementById('tutorialWhyText').textContent = t.tutorialWhyText;
            document.getElementById('tutorialHowTitle').textContent = t.tutorialHowTitle;
            document.getElementById('tutorialHowText').textContent = t.tutorialHowText;
            document.getElementById('startGameBtn').textContent = t.startGame;
            
            // Update list
            const listElement = document.getElementById('tutorialWhyList');
            listElement.innerHTML = '';
            t.tutorialWhyList.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                listElement.appendChild(li);
            });
        }

        function startGame() {
            document.getElementById('tutorial').classList.add('hidden');
            document.getElementById('statsContainer').classList.remove('hidden');
            document.getElementById('progressBarContainer').classList.remove('hidden');
            document.getElementById('gameContent').classList.remove('hidden');
            initGame();
        }

        function updateStats() {
            document.getElementById('compassionScore').textContent = compassionScore;
            document.getElementById('livesTouched').textContent = livesTouched;

            // Always show all categories; just update their counters
            const totalScenarios = gameScenarios.length || SCENARIOS_PER_GAME;
            const scenarioDisplay = currentScenario >= totalScenarios
                ? `${totalScenarios}/${totalScenarios}`
                : `${currentScenario + 1}/${totalScenarios}`;
            document.getElementById('scenarioNumber').textContent = scenarioDisplay;

            document.getElementById('exercisesNumber').textContent = `${Math.min(selfCompassionExercise, 4)}/4`;
            document.getElementById('quizNumber').textContent = `${quizProgress}/1`;
        }

        function updateProgress() {
            const progressBar = document.getElementById('progressBar');
            let progress = 0;

            // Final quiz phase: start at 0% and reach 100% when quiz is completed
            if (quizActive) {
                progress = (quizProgress / 1) * 100;
                progressBar.style.width = `${progress}%`;
                progressBar.textContent = `${Math.round(progress)}%`;
                return;
            }
            
            // Check if we're in self-compassion section (intro or exercises)
            // selfCompassionExercise is set to 0 when intro is shown, > 0 for exercises
            if (selfCompassionExercise >= 0 && currentScenario >= SCENARIOS_PER_GAME) {
                // We've completed scenarios, now in self-compassion section
                if (selfCompassionExercise === 0) {
                    // At intro screen, show 0% (just started self-compassion)
                    progress = 0;
                } else {
                    // Progress through 4 self-compassion exercises (1, 2, 3, 4)
                    const totalExercises = 4;
                    progress = (selfCompassionExercise / totalExercises) * 100;
                }
            } else {
                // Progress through scenarios
                const totalScenarios = gameScenarios.length || SCENARIOS_PER_GAME;
                if (totalScenarios > 0) {
                    // Start at 0% on the first scenario; reach 100% when all scenarios are completed
                    progress = (currentScenario / totalScenarios) * 100;
                } else {
                    progress = 0;
                }
            }
            
            progressBar.style.width = `${progress}%`;
            progressBar.textContent = `${Math.round(progress)}%`;
        }

        let quizMatches = {}; // Store question index -> answer box id matches
        let quizShuffledQuestions = []; // Store shuffled questions for validation
        let quizAnswerTexts = {}; // Store answer box id -> answer text mapping
        let quizSelectedAnswerBoxId = null; // For mobile tap-to-match

        function isTouchDevice() {
            return (
                (typeof window !== 'undefined' && 'ontouchstart' in window) ||
                (typeof navigator !== 'undefined' && navigator.maxTouchPoints > 0) ||
                (typeof window !== 'undefined' && window.matchMedia && window.matchMedia('(pointer: coarse)').matches)
            );
        }

        function clearQuizSelection() {
            if (!quizSelectedAnswerBoxId) return;
            const prev = document.getElementById(quizSelectedAnswerBoxId);
            if (prev) prev.classList.remove('selected');
            quizSelectedAnswerBoxId = null;
        }

        function clearQuestionMatch(questionIndex) {
            const existingAnswerBoxId = quizMatches[questionIndex];
            if (existingAnswerBoxId) {
                const existingAnswerBox = document.getElementById(existingAnswerBoxId);
                if (existingAnswerBox) {
                    existingAnswerBox.classList.remove('used');
                }
                delete quizMatches[questionIndex];
            }

            const questionBox = document.getElementById(`question-${questionIndex}`);
            if (questionBox) questionBox.classList.remove('has-answer');
            const answerDiv = document.getElementById(`answer-${questionIndex}`);
            if (answerDiv) {
                answerDiv.textContent = '';
                answerDiv.style.display = 'none';
            }
        }

        function findQuestionIndexForAnswer(answerBoxId) {
            const keys = Object.keys(quizMatches);
            for (const qIndex of keys) {
                if (quizMatches[qIndex] === answerBoxId) return parseInt(qIndex);
            }
            return null;
        }

        function assignAnswerToQuestion(questionIndex, answerBoxId) {
            const answerBox = document.getElementById(answerBoxId);
            if (!answerBox) return;

            // If this answer is already used elsewhere, free it first (allows moving answers)
            const existingQuestionForAnswer = findQuestionIndexForAnswer(answerBoxId);
            if (existingQuestionForAnswer !== null && existingQuestionForAnswer !== questionIndex) {
                clearQuestionMatch(existingQuestionForAnswer);
            }

            // Remove previous answer from this question if exists
            if (quizMatches[questionIndex] && quizMatches[questionIndex] !== answerBoxId) {
                clearQuestionMatch(questionIndex);
            }

            // Mark answer as used + store match
            answerBox.classList.add('used');
            quizMatches[questionIndex] = answerBoxId;

            // Update question UI
            const questionBox = document.getElementById(`question-${questionIndex}`);
            if (questionBox) questionBox.classList.add('has-answer');
            const answerDiv = document.getElementById(`answer-${questionIndex}`);
            const answerText = quizAnswerTexts[answerBoxId];
            if (answerDiv) {
                answerDiv.textContent = answerText;
                answerDiv.style.display = 'block';
            }
        }

        function setupQuizTapToMatch() {
            if (!isTouchDevice()) return;
            const t = translations[currentLanguage];

            // Show mobile instruction
            const tapInstructionEl = document.getElementById('quizTapInstruction');
            if (tapInstructionEl) {
                tapInstructionEl.textContent = t.quizTapInstruction;
                tapInstructionEl.style.display = 'block';
            }

            // Disable native drag on touch devices to avoid ‚Äústuck‚Äù drag states
            document.querySelectorAll('.quiz-answer-box').forEach((el) => {
                el.setAttribute('draggable', 'false');
            });

            // Tap answer to select
            document.querySelectorAll('.quiz-answer-box').forEach((el) => {
                el.addEventListener('click', () => {
                    const id = el.id;
                    if (quizSelectedAnswerBoxId === id) {
                        clearQuizSelection();
                        return;
                    }
                    clearQuizSelection();
                    quizSelectedAnswerBoxId = id;
                    el.classList.add('selected');
                });
            });

            // Tap question to place selected answer (or clear if already filled and nothing selected)
            document.querySelectorAll('.quiz-question-box').forEach((el) => {
                const id = el.id; // question-<index>
                const idxStr = id.split('-')[1];
                const qIndex = parseInt(idxStr);
                el.addEventListener('click', () => {
                    if (Number.isNaN(qIndex)) return;

                    if (quizSelectedAnswerBoxId) {
                        assignAnswerToQuestion(qIndex, quizSelectedAnswerBoxId);
                        clearQuizSelection();
                        return;
                    }

                    // No selection: tap a filled question to clear it
                    if (quizMatches[qIndex]) {
                        clearQuestionMatch(qIndex);
                    }
                });
            });
        }

        function showCompassionQuiz() {
            const t = translations[currentLanguage];
            // Hide all other sections
            document.getElementById('scenario').classList.add('hidden');
            document.getElementById('scenariosComplete').classList.add('hidden');
            document.getElementById('selfCompassionTransition').classList.add('hidden');
            document.getElementById('selfCompassionSection').classList.add('hidden');
            document.getElementById('breathingExercise').classList.add('hidden');
            document.getElementById('letterExercise').classList.add('hidden');
            document.getElementById('gratitudeExercise').classList.add('hidden');
            document.getElementById('mantraExercise').classList.add('hidden');
            document.getElementById('compassionQuiz').classList.remove('hidden');

            // Quiz phase (progress starts at 0 until submit)
            quizActive = true;
            quizProgress = 0;
            updateStats();
            updateProgress();
            
            const quizData = compassionQuizData[currentLanguage];
            // Shuffle questions
            quizShuffledQuestions = shuffleArray([...quizData]);
            
            // Collect all answers and shuffle them
            const allAnswers = [];
            quizShuffledQuestions.forEach((q) => {
                allAnswers.push(...q.answers);
            });
            const shuffledAnswers = shuffleArray([...allAnswers]);
            
            // Reset matches
            quizMatches = {};
            quizAnswerTexts = {};
            
            const quizDiv = document.getElementById('compassionQuiz');
            quizDiv.innerHTML = `
                <h2>${t.compassionQuizTitle}</h2>
                <div class="quiz-description">
                    <p>${t.compassionQuizDescription}</p>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #666;">${t.quizDragInstruction}</p>
                    <p id="quizTapInstruction" style="margin-top: 10px; font-size: 0.9em; color: #666; display: none;"></p>
                </div>
                <div class="quiz-container">
                    <div class="quiz-questions-column">
                        ${quizShuffledQuestions.map((q, qIndex) => `
                            <div class="quiz-question-box" 
                                 id="question-${qIndex}" 
                                 ondrop="dropAnswer(event, ${qIndex})" 
                                 ondragover="allowDrop(event)">
                                <div>${q.question}</div>
                                <div class="quiz-dropped-answer" id="answer-${qIndex}" style="display: none;"></div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="quiz-answers-column">
                        ${shuffledAnswers.map((answer, aIndex) => {
                            quizAnswerTexts[`answer-box-${aIndex}`] = answer;
                            return `
                            <div class="quiz-answer-box" 
                                 id="answer-box-${aIndex}"
                                 draggable="true" 
                                 ondragstart="dragStart(event, 'answer-box-${aIndex}')"
                                 data-answer="${answer}">
                                ${answer}
                            </div>
                        `;
                        }).join('')}
                    </div>
                </div>
                <button class="start-game-btn" onclick="submitQuiz()" style="margin-top: 30px;">${t.quizSubmitBtn}</button>
            `;

            setupQuizTapToMatch();
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function dragStart(ev, answerBoxId) {
            ev.dataTransfer.setData("text", answerBoxId);
            const answerBox = document.getElementById(answerBoxId);
            answerBox.classList.add('dragging');
        }

        function dropAnswer(ev, questionIndex) {
            ev.preventDefault();
            const answerBoxId = ev.dataTransfer.getData("text");
            const answerBox = document.getElementById(answerBoxId);
            
            // Remove dragging class
            if (answerBox) answerBox.classList.remove('dragging');

            assignAnswerToQuestion(questionIndex, answerBoxId);
        }

        function submitQuiz() {
            const t = translations[currentLanguage];
            
            let correctCount = 0;
            const totalQuestions = quizShuffledQuestions.length;
            
            // Validate each match
            Object.keys(quizMatches).forEach(qIndex => {
                const answerBoxId = quizMatches[qIndex];
                const answerText = quizAnswerTexts[answerBoxId];
                const question = quizShuffledQuestions[parseInt(qIndex)];
                
                // Check if this answer is correct for this question
                if (question && question.answers[question.correctIndex] === answerText) {
                    correctCount++;
                }
            });
            
            // Award points based on correct answers (10 points per correct answer)
            const pointsEarned = correctCount * 10;
            compassionScore += pointsEarned;
            quizProgress = 1;
            updateStats();
            updateProgress();
            
            const quizDiv = document.getElementById('compassionQuiz');
            const message = typeof t.quizResultsMessage === 'function' 
                ? t.quizResultsMessage(correctCount, totalQuestions)
                : t.quizResultsMessage;
            
            quizDiv.innerHTML = `
                <h2>${t.quizResultsTitle}</h2>
                <div class="quiz-results">
                    <strong>${message}</strong>
                </div>
                <div class="feedback positive" style="margin-top: 20px;">
                    <div style="margin-top: 10px;">+${pointsEarned} ${t.points}</div>
                </div>
                <button class="start-game-btn" onclick="continueAfterQuiz()" style="margin-top: 20px;">${t.quizContinueBtn}</button>
            `;
        }

        function continueAfterQuiz() {
            document.getElementById('compassionQuiz').classList.add('hidden');
            endGame();
        }

        function endGame() {
            document.getElementById('gameContent').classList.add('hidden');
            document.getElementById('gameOver').classList.remove('hidden');
            
            const t = translations[currentLanguage];
            let message = '';
            if (compassionScore >= 120) {
                message = t.finalScore.exceptional(compassionScore, livesTouched);
            } else if (compassionScore >= 80) {
                message = t.finalScore.wonderful(compassionScore, livesTouched);
            } else if (compassionScore >= 50) {
                message = t.finalScore.good(compassionScore, livesTouched);
            } else {
                message = t.finalScore.default(compassionScore, livesTouched);
            }
            
            document.getElementById('finalScore').innerHTML = message;
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            // Save preference to localStorage
            localStorage.setItem('compassionQuestLanguage', lang);
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            document.getElementById('lang-sl').classList.toggle('active', lang === 'sl');
            updateUI();
            // Only restart game if it's already started
            if (document.getElementById('gameContent').classList.contains('hidden') === false) {
                if (gameScenarios.length > 0 || currentScenario > 0) {
                    initGame();
                }
            }
        }

        function initializeLanguage() {
            // Set active button based on current language
            document.getElementById('lang-en').classList.toggle('active', currentLanguage === 'en');
            document.getElementById('lang-sl').classList.toggle('active', currentLanguage === 'sl');
        }

        function restartGame() {
            document.getElementById('gameContent').classList.remove('hidden');
            document.getElementById('gameOver').classList.add('hidden');
            initGame();
        }

        // Initialize language and UI, then show tutorial
        initializeLanguage();
        updateUI();
    </script>
</body>
</html>
